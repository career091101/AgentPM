# Phase 2: 並列分析エージェント実行ガイド

このドキュメントは、x_bookmarks_data.json取得後に実行する5つの分析エージェントの詳細ガイドです。

## 実行方法

**重要**: エージェントA-Dは単一メッセージで並列起動してください（Task toolを4回呼び出し）

---

## エージェントA: テーマ分類・キーワード抽出

**推奨モデル**: Sonnet 4.5
**Thinking**: ON
**推定時間**: 15-20分

### プロンプト（Task tool用）

```
Xブックマークデータからテーマ分類とキーワード抽出を行ってください。

## 入力ファイル
/Users/yuichi/AIPM/aipm_v0/Flow/202512/2025-12-31/x_bookmarks_data.json

## 出力ファイル
/Users/yuichi/AIPM/aipm_v0/Flow/202512/2025-12-31/theme_analysis.md

## 実行手順

1. x_bookmarks_data.json を読み込み
2. 全投稿テキスト（bookmarks[].text）を抽出・結合
3. 日本語・英語混在テキストの形態素解析:
   - 日本語: 正規表現ベースのトークン化（名詞・動詞を優先抽出）
   - 英語: 単語分割（スペース区切り）
   - ストップワード除去（「の」「は」「が」「て」「に」、"the", "a", "an", "is"等）
4. TF-IDF風キーワードスコアリング:
   - 各単語の出現頻度をカウント
   - 上位50単語を抽出
5. キーワードベースのテーマ分類（5-7カテゴリ）:
   - AI/技術系: ChatGPT, Claude, AI, LLM, API, プログラミング等
   - ビジネス系: 起業, 経営, マーケティング, 戦略, ビジネス等
   - クリエイティブ系: デザイン, UI/UX, コンテンツ, 動画等
   - 自己啓発系: 生産性, 習慣, 思考法, 学習等
   - エンタメ系: 動画, 映画, 音楽, ゲーム等
   - その他
6. 各投稿をテーマに分類し、カウント
7. テーマ別投稿数・割合を算出

## 出力形式（Markdown）

```markdown
# テーマ分類・キーワード分析

生成日時: 2025-12-31

## エグゼクティブサマリー

- 総投稿数: {total_count}件
- 最頻テーマ: {top_theme} ({percentage}%)
- 抽出キーワード数: 50語

---

## テーマ別分布

| テーマ | 投稿数 | 割合 | 代表キーワード |
|--------|--------|------|---------------|
| AI/技術 | 45 | 30% | ChatGPT, Claude, AI, LLM, API |
| ビジネス | 30 | 20% | 起業, 経営, マーケティング, 戦略 |
| クリエイティブ | 25 | 17% | デザイン, UI/UX, コンテンツ |
| 自己啓発 | 20 | 13% | 生産性, 習慣, 思考法, 学習 |
| エンタメ | 15 | 10% | 動画, 映画, 音楽, ゲーム |
| その他 | 15 | 10% | - |

---

## 頻出キーワード TOP50

### TOP10
1. ChatGPT: 38回
2. AI: 35回
3. Claude: 28回
4. LLM: 25回
5. API: 22回
6. プログラミング: 20回
7. マーケティング: 18回
8. デザイン: 17回
9. 起業: 15回
10. 生産性: 14回

### TOP11-30
（11位から30位までのキーワードをリスト化）

### TOP31-50
（31位から50位までのキーワードをリスト化）

---

## テーマ別詳細分析

### AI/技術系（45件、30%）

**代表的な投稿例（上位3件）**:
1. "{投稿テキストの抜粋...}"
2. "{投稿テキストの抜粋...}"
3. "{投稿テキストの抜粋...}"

**主要キーワード**:
- ChatGPT: 38回
- AI: 35回
- Claude: 28回

### ビジネス系（30件、20%）

（同様に記載）

### クリエイティブ系（25件、17%）

（同様に記載）

---

## 分析所見

- 最も関心が高いテーマは「{top_theme}」で全体の{percentage}%を占める
- キーワード「{top_keyword}」が{count}回出現し、特に高い関心が見られる
- テーマの多様性: {diversity_score}（5カテゴリ以上に分散している場合は「高」）

---

**分析完了日時**: 2025-12-31
**使用モデル**: Claude Sonnet 4.5
```

## 注意事項

- 形態素解析ライブラリ（MeCab等）がない場合は、正規表現ベースの簡易的なトークン化を使用
- キーワード抽出は頻度ベースで十分（TF-IDFの完全実装は不要）
- テーマ分類は、代表キーワードとのマッチングで自動分類
- 投稿テキストが空の場合はスキップ
```

---

## エージェントB: 投稿者傾向分析

**推奨モデル**: Haiku 4
**Thinking**: OFF
**推定時間**: 10-15分

### プロンプト（Task tool用）

```
Xブックマークデータから投稿者傾向分析を行ってください。

## 入力ファイル
/Users/yuichi/AIPM/aipm_v0/Flow/202512/2025-12-31/x_bookmarks_data.json

## 出力ファイル
/Users/yuichi/AIPM/aipm_v0/Flow/202512/2025-12-31/author_analysis.md

## 実行手順

1. x_bookmarks_data.json を読み込み
2. 投稿者ごとのブックマーク数をカウント:
   - bookmarks[].author_username をキーにグループ化
   - 各著者のブックマーク数を集計
3. 上位20アカウントをブックマーク数の降順でソート
4. 各アカウントの割合を計算（全体に対する比率）
5. 上位10アカウントについて、WebSearchで特徴を取得:
   - 検索クエリ: "{author_username} Twitter プロフィール"
   - 肩書き、専門分野、フォロワー数等を抽出
6. 投稿者の傾向をサマリー化

## 出力形式（Markdown）

```markdown
# 投稿者傾向分析

生成日時: 2025-12-31

## エグゼクティブサマリー

- 分析対象投稿数: {total_count}件
- ユニーク投稿者数: {unique_authors}名
- 最多ブックマーク投稿者: @{top_author} ({count}件、{percentage}%）
- 投稿者集中度: {concentration}（上位10名で{top10_percentage}%を占める）

---

## よくブックマークする投稿者 TOP20

| 順位 | アカウント | ブックマーク数 | 割合 | 特徴 |
|------|-----------|--------------|------|------|
| 1 | @username1 | 15 | 10.0% | AI研究者、OpenAI元社員 |
| 2 | @username2 | 12 | 8.0% | SaaS起業家、元Google PM |
| 3 | @username3 | 10 | 6.7% | デザイナー、UI/UXコンサルタント |
| 4 | @username4 | 9 | 6.0% | マーケター、SNS戦略家 |
| 5 | @username5 | 8 | 5.3% | エンジニア、技術ブロガー |
| ... | ... | ... | ... | ... |

---

## 投稿者カテゴリ別分析

### AI/技術系投稿者（{count}名、{percentage}%）

- @username1: {count}件
- @username2: {count}件

### ビジネス系投稿者（{count}名、{percentage}%）

- @username3: {count}件
- @username4: {count}件

### クリエイティブ系投稿者（{count}名、{percentage}%）

（同様に記載）

---

## 分析所見

- 投稿者の集中度: 上位10名で全体の{top10_percentage}%を占め、特定の投稿者に強く影響されている
- 多様性: {diversity}（100名以上の投稿者がいる場合は「高」）
- 最も影響力のある投稿者: @{top_author}（{specialty}分野）

---

**分析完了日時**: 2025-12-31
**使用モデル**: Claude Haiku 4
```

## 注意事項

- WebSearchが失敗した場合は「特徴」列を空欄にする
- author_usernameが空の場合はスキップ
- 同一投稿者の複数投稿は正しくカウント
```

---

## エージェントC: 時間帯分析

**推奨モデル**: Haiku 4
**Thinking**: OFF
**推定時間**: 10-15分

### プロンプト（Task tool用）

```
Xブックマークデータから時間帯分析を行ってください。

## 入力ファイル
/Users/yuichi/AIPM/aipm_v0/Flow/202512/2025-12-31/x_bookmarks_data.json

## 出力ファイル
/Users/yuichi/AIPM/aipm_v0/Flow/202512/2025-12-31/time_analysis.md

## 実行手順

1. x_bookmarks_data.json を読み込み
2. 各投稿の投稿日時（bookmarks[].posted_at）を抽出
3. ISO形式の日時をパース（例: "2025-12-25T10:30:00+09:00"）
4. 時間帯別にグループ化:
   - 深夜: 0-6時
   - 午前: 6-12時
   - 午後: 12-18時
   - 夜間: 18-24時
5. 曜日別にグループ化（月-日）
6. 月別にグループ化（2024年1月-2025年12月）
7. 各カテゴリの投稿数・割合を算出

## 出力形式（Markdown）

```markdown
# 時間帯分析

生成日時: 2025-12-31

## エグゼクティブサマリー

- 分析対象投稿数: {total_count}件
- 最多時間帯: {top_timeslot} ({percentage}%)
- 最多曜日: {top_weekday} ({percentage}%)
- 最多月: {top_month} ({percentage}%)

---

## 時間帯別ブックマーク数

| 時間帯 | ブックマーク数 | 割合 | 傾向 |
|--------|--------------|------|------|
| 深夜（0-6時） | 5 | 3.3% | 低活動 |
| 午前（6-12時） | 45 | 30.0% | 高活動 |
| 午後（12-18時） | 60 | 40.0% | 最高活動 |
| 夜間（18-24時） | 40 | 26.7% | 中活動 |

**ピーク時間帯**: 午後（12-18時）に最も多くブックマーク

---

## 曜日別ブックマーク数

| 曜日 | ブックマーク数 | 割合 | 傾向 |
|------|--------------|------|------|
| 月曜日 | 25 | 16.7% | 高 |
| 火曜日 | 20 | 13.3% | 中 |
| 水曜日 | 22 | 14.7% | 中 |
| 木曜日 | 18 | 12.0% | 中 |
| 金曜日 | 23 | 15.3% | 高 |
| 土曜日 | 20 | 13.3% | 中 |
| 日曜日 | 22 | 14.7% | 中 |

**ピーク曜日**: 月曜日と金曜日に投稿が多い傾向

---

## 月別ブックマーク数（直近12ヶ月）

| 月 | ブックマーク数 | 割合 | トレンド |
|----|--------------|------|---------|
| 2024年1月 | 10 | 6.7% | - |
| 2024年2月 | 12 | 8.0% | ↑ |
| ... | ... | ... | ... |
| 2025年12月 | 15 | 10.0% | ↑ |

**トレンド**: {trend_description}（増加傾向/減少傾向/横ばい）

---

## 分析所見

- ブックマークのピークは**{top_timeslot}**（{percentage}%）
- 曜日パターン: {weekday_pattern}（平日集中型/週末集中型/均等分散型）
- 月次トレンド: {monthly_trend}

---

**分析完了日時**: 2025-12-31
**使用モデル**: Claude Haiku 4
```

## 注意事項

- posted_atが空の場合はスキップ
- 日時のパースに失敗した場合はエラーログを出力
- タイムゾーンはJST（+09:00）を想定
```

---

## エージェントD: エンゲージメント相関分析

**推奨モデル**: Sonnet 4.5
**Thinking**: ON
**推定時間**: 15-20分

### プロンプト（Task tool用）

```
Xブックマークデータからエンゲージメント相関分析を行ってください。

## 入力ファイル
/Users/yuichi/AIPM/aipm_v0/Flow/202512/2025-12-31/x_bookmarks_data.json

## 出力ファイル
/Users/yuichi/AIPM/aipm_v0/Flow/202512/2025-12-31/engagement_analysis.md

## 実行手順

1. x_bookmarks_data.json を読み込み
2. 各投稿のエンゲージメント指標を抽出:
   - いいね数（bookmarks[].engagement.likes）
   - リツイート数（bookmarks[].engagement.retweets）
   - 返信数（bookmarks[].engagement.replies）
   - ブックマーク数（bookmarks[].engagement.bookmarks）
   - ビュー数（bookmarks[].engagement.views）
3. 各指標の基本統計量を算出:
   - 平均、中央値、最大値、最小値、標準偏差
4. 指標間の相関係数を算出（Pearson相関係数）:
   - いいね数 vs リツイート数
   - いいね数 vs 返信数
   - リツイート数 vs 返信数
5. ブックマーク閾値分析:
   - いいね数が100以上の投稿の割合
   - リツイート数が30以上の投稿の割合
6. エンゲージメントレベル別分類:
   - 低エンゲージメント（いいね<50）
   - 中エンゲージメント（50≤いいね<200）
   - 高エンゲージメント（いいね≥200）

## 出力形式（Markdown）

```markdown
# エンゲージメント相関分析

生成日時: 2025-12-31

## エグゼクティブサマリー

- 分析対象投稿数: {total_count}件
- 平均いいね数: {avg_likes}
- 平均リツイート数: {avg_retweets}
- 最も強い相関: いいね数 vs リツイート数（相関係数 {correlation}）

---

## エンゲージメント指標の分布

| 指標 | 平均 | 中央値 | 最大 | 最小 | 標準偏差 |
|------|------|--------|------|------|---------|
| いいね数 | 120 | 80 | 1500 | 0 | 150 |
| リツイート数 | 45 | 30 | 800 | 0 | 60 |
| 返信数 | 8 | 5 | 120 | 0 | 12 |
| ブックマーク数 | 30 | 20 | 500 | 0 | 40 |
| ビュー数 | 5000 | 3000 | 50000 | 0 | 6000 |

---

## 相関分析

### 指標間の相関係数（Pearson）

| 指標ペア | 相関係数 | 相関の強さ |
|---------|---------|-----------|
| いいね数 vs リツイート数 | 0.85 | 強い正の相関 |
| いいね数 vs 返信数 | 0.65 | 正の相関 |
| いいね数 vs ブックマーク数 | 0.72 | 正の相関 |
| リツイート数 vs 返信数 | 0.58 | 正の相関 |
| リツイート数 vs ブックマーク数 | 0.70 | 正の相関 |

### 相関の解釈

- **いいね数とリツイート数**は強い正の相関（0.85）があり、いいねが多い投稿はリツイートも多い傾向
- **いいね数とブックマーク数**も正の相関（0.72）があり、いいねが多い投稿は保存されやすい
- 全体的に、エンゲージメント指標は互いに連動している

---

## ブックマーク閾値分析

### いいね数別分布

| いいね数範囲 | 投稿数 | 割合 | 傾向 |
|-------------|--------|------|------|
| 0-49 | 30 | 20.0% | 低エンゲージメント |
| 50-99 | 35 | 23.3% | 中エンゲージメント（低） |
| 100-199 | 40 | 26.7% | 中エンゲージメント（高） |
| 200-499 | 30 | 20.0% | 高エンゲージメント |
| 500+ | 15 | 10.0% | 超高エンゲージメント |

**ブックマーク傾向**:
- 50%以上のブックマークはいいね数100以上の投稿
- 80%以上のブックマークはリツイート数30以上の投稿

### リツイート数別分布

| リツイート数範囲 | 投稿数 | 割合 |
|-----------------|--------|------|
| 0-29 | 45 | 30.0% |
| 30-59 | 50 | 33.3% |
| 60-99 | 30 | 20.0% |
| 100+ | 25 | 16.7% |

---

## エンゲージメントレベル別分類

| エンゲージメントレベル | 投稿数 | 割合 | 代表的な投稿例 |
|--------------------|--------|------|--------------|
| 低（いいね<50） | 30 | 20.0% | "{投稿テキスト抜粋}" |
| 中（50≤いいね<200） | 75 | 50.0% | "{投稿テキスト抜粋}" |
| 高（いいね≥200） | 45 | 30.0% | "{投稿テキスト抜粋}" |

---

## 分析所見

- ブックマークする投稿の**{percentage}%**がいいね数100以上のミドル～ハイエンゲージメント投稿
- エンゲージメント指標間には強い相関があり、質の高い投稿は複数の指標で高評価を得る
- ブックマーク基準: いいね数{threshold_likes}以上、またはリツイート数{threshold_retweets}以上の投稿を選好

---

**分析完了日時**: 2025-12-31
**使用モデル**: Claude Sonnet 4.5
```

## 注意事項

- エンゲージメント指標が0の場合も正常データとして扱う
- 相関係数の計算には、numpy等のライブラリを使用せず、手動計算でも可
- 相関の強さの判定基準:
  - 0.7以上: 強い相関
  - 0.4-0.7: 正の相関
  - 0.0-0.4: 弱い相関
```

---

## エージェントE: ビジュアル化レポート統合生成

**推奨モデル**: Sonnet 4.5
**Thinking**: ON
**推定時間**: 20-25分

**注意**: エージェントA-D完了後に実行

### プロンプト（Task tool用）

```
エージェントA-Dの分析結果を統合し、ビジュアル化レポートを生成してください。

## 入力ファイル
- /Users/yuichi/AIPM/aipm_v0/Flow/202512/2025-12-31/theme_analysis.md
- /Users/yuichi/AIPM/aipm_v0/Flow/202512/2025-12-31/author_analysis.md
- /Users/yuichi/AIPM/aipm_v0/Flow/202512/2025-12-31/time_analysis.md
- /Users/yuichi/AIPM/aipm_v0/Flow/202512/2025-12-31/engagement_analysis.md

## 出力ファイル
/Users/yuichi/AIPM/aipm_v0/Flow/202512/2025-12-31/x_bookmark_analysis_report.md

## 実行手順

1. 4つの分析ファイルを全て読み込み
2. 各分析のエグゼクティブサマリーを抽出
3. グラフ・チャートを生成（matplotlib/plotlyを使用）:
   - テーマ分布円グラフ
   - 時間帯分布棒グラフ
   - エンゲージメント散布図（いいね vs リツイート）
   - 投稿者TOP10棒グラフ
4. 総合考察を生成:
   - 全分析結果からの気づき・インサイト
   - ブックマーク傾向の特徴
   - 改善提案
5. アクションプランを作成:
   - X投稿戦略の提案
   - フォローすべきアカウント
   - 最適な投稿時間帯

## 出力形式（Markdown）

```markdown
# Xブックマーク傾向分析レポート

**生成日時**: 2025-12-31
**分析対象期間**: {period}
**総ブックマーク数**: {total_count}件

---

## エグゼクティブサマリー

### 主要発見事項

1. **テーマ**: 最も関心が高いのは「{top_theme}」（{percentage}%）
2. **投稿者**: @{top_author}の投稿を最も多くブックマーク（{count}件）
3. **時間帯**: {top_timeslot}に投稿が集中（{percentage}%）
4. **エンゲージメント**: いいね数平均{avg_likes}、中央値{median_likes}

### 一言サマリー

{one_sentence_summary}

---

## 1. テーマ分類

{theme_analysis.mdの主要部分を統合}

### テーマ分布（円グラフ）

![テーマ分布](./charts/theme_distribution.png)

### 主要テーマの特徴

- **AI/技術**: {description}
- **ビジネス**: {description}
- **クリエイティブ**: {description}

---

## 2. 投稿者傾向

{author_analysis.mdの主要部分を統合}

### 投稿者TOP10（棒グラフ）

![投稿者TOP10](./charts/top_authors.png)

### 影響力のある投稿者

{top_authors_description}

---

## 3. 時間帯分析

{time_analysis.mdの主要部分を統合}

### 時間帯別分布（棒グラフ）

![時間帯分布](./charts/time_distribution.png)

### 活動パターン

{activity_pattern_description}

---

## 4. エンゲージメント相関

{engagement_analysis.mdの主要部分を統合}

### エンゲージメント散布図（いいね vs リツイート）

![エンゲージメント散布図](./charts/engagement_scatter.png)

### ブックマーク基準

{bookmark_criteria_description}

---

## 5. 総合考察

### 5.1 ブックマーク傾向の特徴

全4つの分析結果から、以下の傾向が明らかになりました：

1. **関心テーマの集中**: {insight_1}
2. **情報源の偏り**: {insight_2}
3. **時間帯の特徴**: {insight_3}
4. **品質重視**: {insight_4}

### 5.2 発見された パターン

- **コンテンツの質**: エンゲージメントが高い（いいね100以上）投稿を優先的にブックマーク
- **専門性**: 特定分野（{top_theme}）の専門家（@{top_author}等）の投稿を選好
- **タイミング**: {top_timeslot}の投稿を多くキャッチアップ

### 5.3 自己分析

{self_reflection}

---

## 6. アクションプラン

### 6.1 X投稿戦略

ブックマーク傾向を踏まえ、以下の投稿戦略を推奨します：

1. **投稿テーマ**: {recommended_theme}を中心に発信
2. **投稿時間**: {optimal_time}に投稿（最もアクティブな時間帯）
3. **投稿スタイル**: {recommended_style}（エンゲージメント高い投稿の特徴）

### 6.2 フォロー推奨アカウント

{top_theme}分野の情報収集強化のため、以下のアカウントをフォロー:

- @{username1}: {reason}
- @{username2}: {reason}
- @{username3}: {reason}

### 6.3 コンテンツキュレーション改善

- **多様性向上**: 現在{top_theme}に偏っているため、{other_themes}も積極的にブックマーク
- **タイムライン最適化**: {optimal_time}の情報収集を強化

---

## 7. 付録

### 7.1 分析メトリクス

| 指標 | 値 |
|------|-----|
| 総ブックマーク数 | {total_count}件 |
| ユニーク投稿者数 | {unique_authors}名 |
| 分析期間 | {period} |
| 最頻テーマ | {top_theme} |
| 最多投稿者 | @{top_author} |

### 7.2 使用ツール

- データ収集: X Bookmark Scraper (Playwright)
- 分析: Claude Sonnet 4.5 / Haiku 4
- ビジュアル化: Matplotlib / Plotly

---

**レポート生成日時**: 2025-12-31
**使用モデル**: Claude Sonnet 4.5
**分析実行時間**: {execution_time}分
```

## 注意事項

- グラフ生成にはmatplotlib/plotlyを使用（インストール必要）
- グラフ画像は`./charts/`ディレクトリに保存
- 各分析ファイルが存在しない場合はエラーを出力
- 総合考察は必ず**具体的な数値**を含める
```

---

## 並列実行の手順

### ステップ1: エージェントA-Dを並列起動

**単一メッセージで以下の4つのTask toolを呼び出してください**:

```
Task tool 1: subagent_type="general-purpose", prompt="{エージェントAのプロンプト}", run_in_background=True, model="sonnet"
Task tool 2: subagent_type="general-purpose", prompt="{エージェントBのプロンプト}", run_in_background=True, model="haiku"
Task tool 3: subagent_type="general-purpose", prompt="{エージェントCのプロンプト}", run_in_background=True, model="haiku"
Task tool 4: subagent_type="general-purpose", prompt="{エージェントDのプロンプト}", run_in_background=True, model="sonnet"
```

### ステップ2: エージェントA-Dの完了確認

TaskOutput toolで各エージェントの完了を確認:

```
TaskOutput(task_id="agent_a_id", block=True)
TaskOutput(task_id="agent_b_id", block=True)
TaskOutput(task_id="agent_c_id", block=True)
TaskOutput(task_id="agent_d_id", block=True)
```

### ステップ3: エージェントEを起動

```
Task tool: subagent_type="general-purpose", prompt="{エージェントEのプロンプト}", model="sonnet"
```

---

**準備完了！** x_bookmarks_data.json取得後、このガイドに従って並列分析を実行してください。
