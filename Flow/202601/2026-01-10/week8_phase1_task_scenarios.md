# Week 8 Phase 1: Ralph Wiggum定常タスク調査レポート

**調査日**: 2026-01-10
**調査者**: Claude Code
**対象**: @docs/implementation_guides/week8_ralph_wiggum.md に定義された4つのシナリオ

---

## 調査サマリー

| シナリオ | 評価 | 実行可能性 | 推定コスト | リスク |
|---------|------|----------|---------|--------|
| **シナリオA** (スキルドキュメント生成) | **実行可能** | 18/25点 | $5-12 | **低** |
| **シナリオB** (パス参照統一) | **要調整** | 12/25点 | $8-15 | **中** |
| **シナリオC** (テストカバレッジ向上) | **要調整** | 10/25点 | $12-20 | **高** |
| **シナリオD** (ドキュメント翻訳) | **実行可能** | 20/25点 | $3-7 | **低** |

**総合評価**: 60/100点
**推奨実行順序**: D → A → B → C
**総推定コスト**: $28-54（Haiku使用時）

---

## 詳細調査結果

### シナリオA: スキルドキュメント生成

#### 対象ファイル数の実績調査

```bash
# 実際の調査結果
.claude/skills/ ディレクトリ内スキル数: 83-85個
既存SKILL.md: 74個（88%完成率）
README.md: 20個程度（24%）
コマンド定義: 10個未満（12%）

# 副業プロジェクト向けスキル
Stock/programs/副業/projects/SNS/.claude/skills/: 1個
for_startup/: 12個スキル
for_genai/: 20個スキル+

# 総スキル数: ~170個以上（main + for_startup + for_genai 含む）
```

#### 実行可能性評価: 18/25点

**完了条件の明確性**: 15/15点 ✅
- 26スキル × 3コンポーネント = 78ファイルの定義が明確
- 期待効果が具体的（一括管理）
- ただし、実際のスキル数は定義（26個）より大幅に多い（83-170個）

**イテレーション数の妥当性**: 8/10点 ⚠️
- 提案: 30イテレーション
- 実績: 83スキルで30イテレーションは不足の可能性
  - 1イテレーション = 2-3スキル処理が現実的
  - 83個÷2.5 = 33イテレーション必要（提案より3回多い）
- **修正提案**: max-iterations を35-40に引き上げ

**対象範囲の具体性**: 12/15点 ⚠️
- 74個のSKILL.mdは既に存在（88%完成）
- 残り9個のスキルにSKILL.mdが不足
- **実施内容の再定義が必要**:
  - 欠落SKILL.md作成（9個）
  - 既存SKILL.md品質向上（レビュー、例追加）
  - README.md生成（54個不足）
  - コマンド定義生成（64個不足）

**コスト見積もり**: 2/5点 ✅（イテレーション数の調整が必要）
- 提案: 30イテレーション → $6-12（Haiku）
- 修正見積もり: 38-42イテレーション → $7-16（Haiku）

#### リスク評価

| リスク | 発生確率 | 影響度 | 軽減策 |
|--------|--------|--------|--------|
| **無限ループ** | 中 | 高 | 明確な完了基準を設定（例: "all 83 skills have SKILL.md"） |
| **コンテキスト肥大化** | 中 | 中 | `.claudeignore`で不要ファイル除外（Stock/, Archived/） |
| **品質ばらつき** | 高 | 中 | Review Agent統合（Week 6の review_loop 参照） |
| **実装範囲の誤認識** | 高 | 中 | スキルの定義を明確化（83個すべて vs 26個基本スキルのみ） |

---

### シナリオB: パス参照の統一

#### 対象ファイル数の実績調査

```bash
# 実際の硬コードパス数
.md ファイル内: 61件の /Users/yuichi/AIPM パス参照
.py ファイル内: 47件の /Users/yuichi/AIPM パス参照

# 対象ファイル数
docs/: 26 .md ファイル
.claude/skills/: 74 SKILL.md + 複数の説明ファイル
scripts/: 75 .py ファイル
その他 .md/.py: ~150個

# 総対象ファイル: 325個以上
```

#### 実行可能性評価: 12/25点 ⚠️

**完了条件の明確性**: 8/15点 ⚠️
- プロンプト内容: 「ハードコードパスを環境変数に置換」
- **問題**: 3つの異なるアプローチの優先順位が不明確
  1. 環境変数（AIPM_ROOT）
  2. pathlib.Path相対パス
  3. シンボリックパス（@-prefix）

- @.claude/rules/path_conventions.md では「全角括弧の統一」は定義されているが、パス置換戦略の詳細定義がない
- **修正提案**: シナリオプロンプトに優先順位を明記
  ```
  優先順位:
  1. 環境変数ベースパス（AIPM_ROOT）→ pathlib化
  2. 相対パス化（pathlib.Path使用）
  3. シンボリックパス（@-prefix）は参照用のみ
  ```

**イテレーション数の妥当性**: 5/10点 ❌
- 提案: 25イテレーション
- 実績調査: 108個のパス参照 + 325個のファイル確認が必要
  - ファイルごとに平均0.5-1箇所のパス修正
  - 325個÷2-4 = 81-162個の修正操作
  - 1イテレーション = 1-2ファイル処理が上限
  - **必要イテレーション: 50-80回** ⚠️ 提案の2-3倍

**対象範囲の具体性**: 7/15点 ⚠️
- 対象ファイル範囲が曖昧
- docs/, scripts/, .claude/skills/ は明確
- しかし、Flow/, Stock/, Archived/ 内のファイルは不明
- 以下の重複処理リスク:
  - Archived/ フォルダも処理対象か?
  - Stock/ 内の古いドキュメント版も処理対象か?

**コスト見積もり**: 2/5点 ❌
- 提案: 25イテレーション × $1 = $25（Haiku）
- 修正見積もり: 60-80イテレーション × $1 = $60-80（Haiku）
- **予算超過リスク: 2-3倍**

#### リスク評価（高リスク）

| リスク | 発生確率 | 影響度 | 軽減策 |
|--------|--------|--------|--------|
| **意図しない変更** | 高 | 高 | 詳細スコープ定義、新規ブランチでの段階的実行 |
| **パス参照の誤変換** | 高 | 中 | テスト用の小規模ブランチで検証（5-10ファイル） |
| **無限ループ** | 中 | 高 | 明確な完了基準（"no hardcoded /Users paths found"） |
| **コスト超過** | 高 | 高 | イテレーション上限50回でテスト実行 |
| **復旧難易度** | 高 | 高 | コミットを日ごとに分割（追跡可能に） |

#### 重大な問題点

1. **スコープが不透明**: 325個ファイル全体をカバーできるか不明
2. **優先順位が不明**: 環境変数 vs pathlib vs @-prefix の優先度がない
3. **テスト戦略がない**: パス置換後の動作検証が不明
4. **段階的実行が推奨**: 全体一括ではなく、段階的な実行に変更すべき

---

### シナリオC: テストカバレッジ向上

#### 対象ファイル数の実績調査

```bash
# 実際の Python スクリプト数
scripts/ 直下: 75 .py ファイル
scripts/mcp_servers/: 12 .py ファイル
scripts/solopreneur_data_pipeline/: 8 .py ファイル
tests/ ディレクトリ: 1個のテストファイル（test_completion_judge.py）

# 総ファイル数: 95個
# 既存テストカバレッジ: ~0%（tests/の内容が最小限）
```

#### 実行可能性評価: 10/25点 ❌（実行不可推奨）

**完了条件の明確性**: 8/15点 ⚠️
- 完了基準: 「coverage reaches 70%」
- **問題1**: 全スクリプトの 70%は非常に高い目標
  - 実際の困難さ: テスト対象ファイル × 複数テストケース必須
  - 例: 1ファイルで70%カバレッジを目指すと、最低5-10テストケースが必要
  - 95ファイル × 5ケース最小 = 475テストケース実装

- **問題2**: スクリプトの性質による困難さ
  - API連携スクリプト: モック化が複雑
  - PDFパーサー: 入力ファイル準備が必要
  - SNS分析: 外部API依存

**イテレーション数の妥当性**: 3/10点 ❌
- 提案: 40イテレーション
- 実績推定:
  - 95ファイル × 1イテレーション（1-2ファイル/回） = 47-95イテレーション
  - さらに「70%カバレッジ達成」という動的な完了基準
  - Ralphは coverage % を自動測定できないため、手動チェックが必要
  - **実現不可能**: Ralphループ内でカバレッジ計測ができない

**対象範囲の具体性**: 2/15点 ❌
- scripts/ 内の全ファイルが対象とされているが、以下が曖昧
  1. mcp_servers/ 内のスクリプト: 複数の依存関係が必要
  2. solopreneur_data_pipeline/: 複雑なパイプライン、テスト化困難
  3. テスト対象外スクリプト: GitHub Actions統合など、テスト不可能なものもある

**コスト見積もり**: 1/5点 ❌
- 提案: 40イテレーション × $1 = $40（Haiku）
- 実績推定: 80-120イテレーション × $1 = $80-120
- **高リスク**: 提案コスト の2-3倍

#### リスク評価（極度に高リスク）

| リスク | 発生確率 | 影響度 | 判定 |
|--------|--------|--------|------|
| **無限ループ** | **極高** | 高 | Ralphが「70%カバレッジ到達」を自動判定できない |
| **コスト爆発** | **極高** | 高 | 提案コストの3-4倍に達する可能性 |
| **完了不可** | **高** | 極高 | Ralph自体が0%テストから70%へ自動到達を実現できない仕組み |
| **品質問題** | 高 | 中 | 自動生成テストのカバレッジ虚増（実テスト価値低い） |

#### 結論: **このシナリオは実行不推奨**

**理由**:
1. **Technical Blocker**: Ralphは `coverage`コマンドの出力を解析して自動判定する機能がない
   - max-iterations 40回に達しても「70%カバレッジ」の達成判定ができない
   - 結果として無限ループに陥る可能性が高い

2. **実装の複雑さ**: 95ファイル × 複数テストケース実装は手作業レベルのタスク
   - Ralphの得意領域（機械的バッチ処理）ではない
   - 各ファイルのテスト設計には人間の判断が必要

3. **代替案**: 段階的なテストカバレッジ向上を推奨
   - Phase 1: 重要な 10 ファイルのテスト実装（Ralphで可能）
   - Phase 2: カバレッジ計測スクリプト作成（Week 2で実施済み）
   - Phase 3: 追加テストはマニュアル実装

---

### シナリオD: ドキュメント翻訳（日英）

#### 対象ファイル数の実績調査

```bash
# docs/ ディレクトリの .md ファイル
docs/ai/: 11個
docs/implementation_guides/: 11個
その他 docs: 4個
総計: 26個

# 日本語ドキュメント判定
明らかに日本語のみ:
- docs/ai/pmbok_workflow.md
- docs/ai/overview.md
- docs/implementation_guides/ ファイル群（ほぼ全て）
- などなど

推定: 20個以上が日本語
```

#### 実行可能性評価: 20/25点 ✅

**完了条件の明確性**: 15/15点 ✅
- 明確: 「all .md files have English versions」
- 実装可能: suffix ルール（_ja で日本語保持）
- 検証可能: `ls docs/**/*_ja.md` で確認可能

**イテレーション数の妥当性**: 10/15点 ✅
- 提案: 20イテレーション
- 実績推定:
  - 20-26個のMarkdownファイル
  - 1イテレーション = 1-2ファイル処理が現実的
  - 20個÷1.5 = 13-14イテレーション
  - **提案20回は余裕あり** ✅（+6-7回のバッファ）

**対象範囲の具体性**: 15/15点 ✅
- docs/ 内のファイルが明確
- 翻訳対象の明確化: 日本語のみの記述セクション
- suffix ルール: _ja で日本語版を保持（実装可能）

**コスト見積もり**: 5/5点 ✅
- 提案: 20イテレーション × $1-2 = $20-40（Sonnet推奨）
- Haikuで削減可能: 20イテレーション × $0.5 = $10-20
- **妥当性**: 見積もり精度が高い ✅

#### リスク評価

| リスク | 発生確率 | 影響度 | 軽減策 |
|--------|--------|--------|--------|
| **翻訳品質** | 中 | 中 | プロンプトに「技術用語の統一」を記載 |
| **リンク破損** | 低 | 中 | markdown 構造保持を強調（フロントマター含む） |
| **無限ループ** | 低 | 中 | 明確な完了基準（"all 20 .md files translated"） |
| **コンテキスト肥大化** | 低 | 低 | docs/ のみなので軽量 |

#### 実装上の注意点

1. **モデル選択**: Sonnet推奨（翻訳品質が重要）
2. **プロンプト例**:
   ```bash
   /ralph-loop "Translate all .md files in docs/ to English:
   - Original Japanese files: keep as-is, add _ja suffix copy
   - Create English versions: remove _ja suffix
   - Preserve all markdown structure, frontmatter, and links
   - Use consistent technical terminology

   Output <promise>TRANSLATION COMPLETE</promise> when all 26 .md files have English versions." \
   --completion-promise "TRANSLATION COMPLETE" \
   --max-iterations 25
   ```

---

## 推奨実行順序

### 1. **シナリオD（ドキュメント翻訳）** - 実行開始

**理由**:
- ✅ 最も安全（リスク低、完了条件明確）
- ✅ コスト効率的（$10-20）
- ✅ 実装時間短い（実行時間 1-2 時間）
- ✅ Week 4-7 の実装と独立（並列実行可能）
- ✅ 成功確率高い（80%以上）

**実行日程**: 即日実行可能

---

### 2. **シナリオA（スキルドキュメント生成）** - 実行可能（調整必要）

**条件付き実行**:
- ✅ max-iterations を 30 → **38-40に引き上げ**
- ✅ 完了基準を明確化: "all 83 skills have SKILL.md" に変更
- ⚠️ 事前に `.claudeignore` で Stock/, Archived/ を除外
- ⚠️ スキル数の定義を確認（26個 vs 83個の齟齬）

**推定実行時間**: 2-3 時間
**推定コスト**: $7-16（Haiku）

**リスク軽減策**:
1. Phase 1: for_startup/ スキル（12個）で試験実行
2. Phase 2: main スキル（74個）で本実行
3. Phase 3: for_genai/ スキル（20個+）で追加

---

### 3. **シナリオB（パス参照統一）** - 段階的実行（要リプランニング）

**実行不可（現状では）** - 以下の理由で推奨しない:

1. **スコープが不明**: 325ファイル全体の管理が困難
2. **イテレーション数が過小評価**: 25回 → 60-80回必要
3. **優先順位が不明**: 環境変数 vs pathlib vs @-prefix

**代替案（推奨）**:

段階的実施に変更:
- **Phase 1** (Week 9): docs/ のみ（26ファイル）
  - イテレーション: 20回
  - コスト: $10-15
  - 完了条件: "no /Users/yuichi paths in docs/"

- **Phase 2** (Week 10): scripts/ のみ（75ファイル）
  - イテレーション: 30回
  - コスト: $15-25

- **Phase 3** (Week 11): .claude/skills/ （74ファイル）
  - イテレーション: 25回
  - コスト: $12-20

**総コスト（段階的）**: $37-60 ✅（一括より低リスク）

---

### 4. **シナリオC（テストカバレッジ向上）** - 実行不推奨

**判定**: ❌ **現状では実行できない**

**理由**:
1. Ralphが `coverage` の自動判定できない（Technical Blocker）
2. 95ファイル × 70%カバレッジは過度に高い目標
3. イテレーション数が過小評価（40回 → 80-120回）
4. 無限ループリスクが極高

**代替案（推奨）**:

マニュアル段階的テスト実装:
- **Phase 1**: 重要スクリプト 10 個を厳選
- **Phase 2**: Ralphで各5テストケース追加（50イテレーション）
- **Phase 3**: 定期的なカバレッジ向上（カバレッジ計測スクリプト使用）

---

## 全体的なリスク評価と軽減策

### リスク1: 無限ループ（全シナリオ共通）

**軽減策**:
- ✅ 明確な完了条件を `<promise>` タグで指定
- ✅ `--max-iterations` を必ず設定
- ✅ 初回は低めのイテレーション数でテスト

### リスク2: コスト超過（シナリオB・C特に）

**軽減策**:
- ✅ Haikuモデル推奨（コスト50%削減）
- ✅ 段階的実行で上限を小分け
- ✅ `/context` で定期監視

### リスク3: コンテキスト肥大化

**軽減策**:
- ✅ `.claudeignore` に以下を追加:
  ```
  Archived/
  Stock/
  node_modules/
  .venv/
  __pycache__/
  *.log
  ```

### リスク4: 意図しない変更（シナリオB特に）

**軽減策**:
- ✅ 新規ブランチ: `git checkout -b ralph-<task>`
- ✅ 各イテレーション後に `git diff` で確認
- ✅ 段階的実行で影響範囲を限定

---

## 実装ガイドライン

### Week 8実行スケジュール提案

```
Day 1 (今日):
- シナリオD実行開始
  /ralph-loop "Translate docs/ to English..." \
    --completion-promise "TRANSLATION COMPLETE" \
    --max-iterations 25

Day 2:
- シナリオA（Phase 1: for_startup）実行
  /ralph-loop "Generate SKILL.md for for_startup/..." \
    --completion-promise "STARTUP SKILLS COMPLETE" \
    --max-iterations 20

Day 3:
- シナリオD完了確認
- シナリオA（Phase 2: main skills）実行開始
  /ralph-loop "Generate SKILL.md for main skills..." \
    --completion-promise "MAIN SKILLS COMPLETE" \
    --max-iterations 40
```

### Week 9-11: シナリオB段階的実行

```
Week 9: Docs パス統一
Week 10: Scripts パス統一
Week 11: Skills パス統一
```

### シナリオC: 代替実装

```
Week 12+: 重要スクリプト 10 個限定でテスト追加
```

---

## チェックリスト（実行前確認）

### 共通

- [ ] Gitブランチ作成: `git checkout -b ralph-<task-name>`
- [ ] 現在の状態をコミット: `git add . && git commit -m "chore: snapshot"`
- [ ] コンテキスト確認: `/context` （50%以下）
- [ ] `.claudeignore` 確認（Archived/, Stock/ 除外）
- [ ] `--max-iterations` を明示的に設定
- [ ] 完了条件を `<promise>` タグで定義

### シナリオD実行前

- [ ] docs/ 内の日本語ファイル確認
- [ ] Sonnetモデル有効（翻訳品質重視）
- [ ] suffix ルール（_ja）が実装可能か確認

### シナリオA実行前

- [ ] スキル数の定義を明確化（26個 vs 83個）
- [ ] max-iterations を 40 に設定
- [ ] for_startup/ でPhase 1テスト実行予定

### シナリオB実行前（将来）

- [ ] 段階的実行計画を策定
- [ ] Phase 1: docs/ のみに限定
- [ ] テスト用の小規模ブランチで検証
- [ ] パス変換ルールの優先順位を定義

---

## 参考資料

- @docs/implementation_guides/week8_ralph_wiggum.md
- @.claude/rules/context_management.md
- @.claude/rules/path_conventions.md
- @.claude/rules/execution_preference.md

---

## 最終推奨

### 即実行すべき

1. **シナリオD**: ドキュメント翻訳（本日実行）
   - リスク最小、効果最大
   - 実行時間: 1-2時間

2. **シナリオA** (修正版): スキルドキュメント生成（明日以降）
   - max-iterations を 40 に引き上げ
   - スキル数の定義を確認
   - Phase 1: for_startup で試験実行

### 段階的に実施

3. **シナリオB** (段階化版): パス参照統一
   - Week 9-11にかけて段階的実行
   - Phase 1: docs/ のみ
   - Phase 2: scripts/ のみ
   - Phase 3: skills/ のみ

### 実行非推奨

4. **シナリオC**: テストカバレッジ向上
   - 現状では技術的に実現困難
   - 代替案: マニュアル段階的テスト実装

---

**作成日**: 2026-01-10
**次アクション**: シナリオD の Ralph Wiggum 実行承認取得
