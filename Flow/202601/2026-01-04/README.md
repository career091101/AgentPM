# 歯科医院院長名収集タスク - 実行ガイド

**作成日**: 2026-01-04
**対象**: 歯科医院リスト（行108-214）107医院の院長名収集
**出力**: `director_names_batch_2.csv`

---

## タスク概要

歯科医院リストCSVファイル（行108-214）から、各医院の院長名をインターネット検索で収集し、CSV形式で出力するタスクです。

### 実行内容

| 項目 | 内容 |
|------|------|
| **対象範囲** | CSVファイル 行108-214（107医院） |
| **データソース** | 公式ウェブサイト + 公開検索エンジン |
| **出力形式** | CSV（医院名, 院長名） |
| **推定実行時間** | 8-10分 |
| **API使用量** | WebFetch 80件 + WebSearch 27件 |

---

## ファイル構成

```
Flow/202601/2026-01-04/
├── README.md                              # このファイル
├── DIRECTOR_COLLECTION_WORKFLOW.md        # 詳細ワークフロー定義
├── implement_director_collection.md       # 実装ガイド・コード例
├── collect_directors_batch_2.py           # Python実行スクリプト
└── director_names_batch_2.csv             # 出力ファイル（未作成）
```

### ファイル説明

#### 1. **DIRECTOR_COLLECTION_WORKFLOW.md** (詳細ワークフロー)

**内容**:
- タスク概要
- 医院情報の詳細リスト（107医院）
- 実装手順の詳細
- エラーハンドリング方法
- パフォーマンス予測
- 品質管理基準

**使用時機**:
- 全体像の理解
- 実装時の参考

#### 2. **implement_director_collection.md** (実装ガイド)

**内容**:
- 実装方針（逐次処理 vs 並列処理）
- WebFetch/WebSearch パターン
- 院長名抽出ロジック
- Python実装例
- 検証方法
- トラブルシューティング

**使用時機**:
- Claude Code内での実装
- 個別医院での確認
- パターン学習

#### 3. **collect_directors_batch_2.py** (実行スクリプト)

**内容**:
- 107医院の医院名・URLリスト
- CSVファイル読み込み/書き込み処理
- エラーハンドリングフレームワーク

**使用時機**:
- メイン処理の自動実行
- バッチ処理の実装

---

## 実行方法

### 方法A: 手動逐次実行（推奨）

**概要**: 医院ごとにWebFetch/WebSearchを実施し、結果をマニュアルで記録

**実行時間**: 約10分
**メリット**: 動作確認しながら実施できる、確実性が高い
**デメリット**: 手作業が多い

**手順**:

1. **最初の5医院のテスト実行**

```markdown
## テスト医院1: むらつ歯科クリニック

**公式サイト**: https://muratsu-dc.jp/

**WebFetch実行**:
/fetch https://muratsu-dc.jp/

**確認内容**:
- ページから「院長」「理事長」を検索
- 前後50文字のコンテキスト抽出
- 敬称削除

**期待される結果**: 院長名（敬称なし）
```

2. **パターン確認**

以下の5つのパターンに遭遇した場合の処理方法:

| パターン | 例 | 処理方法 |
|--------|-----|--------|
| **院長タグ有** | `<div class="director">山田太郎</div>` | そのまま採用 |
| **テキスト記述** | `当クリニックの院長は田中花子です` | テキストから抽出 |
| **敬称付き** | `Dr. 山田太郎` | 敬称削除後採用 |
| **複数候補** | `山田太郎、田中花子` | 最初の1名のみ |
| **見つからない** | 院長情報なし | WebSearchにフォールバック |

3. **WebSearch フォールバック（見つからない場合）**

```markdown
/search むらつ歯科クリニック 院長

検索結果から院長名を抽出
```

4. **結果をCSVに記録**

```
むらつ歯科クリニック,村津太郎
```

### 方法B: 自動バッチ処理（高速）

**概要**: Pythonスクリプトで全医院を自動処理

**実行時間**: 約8分
**メリット**: 高速、確実、スケール可能
**デメリット**: エラー対応が複雑

**手順**:

```bash
# スクリプト実行
cd /Users/yuichi/AIPM/aipm_v0/Flow/202601/2026-01-04
python3 collect_directors_batch_2.py
```

**実装内容**（スクリプト内に統合予定）:

```python
# WebFetchで公式サイトから検索
if "院長" in page_content:
    director_name = extract_from_context()

# WebSearchでフォールバック
if director_name == "不明":
    director_name = search_by_query(clinic_name)

# CSV記録
write_to_csv(clinic_name, director_name)

# レート制限: 2秒待機
time.sleep(2)
```

---

## 院長名抽出ロジック

### パターン1: 公式サイトから直接抽出

**流れ**:
```
WebFetch → ページ取得 → 「院長」キーワード検索 → テキスト抽出 → 敬称削除 → 氏名確定
```

**キーワード**: `院長`, `理事長`, `Dr.`, `医学博士`, `代表医師`

**コード例**:
```python
def extract_from_website(html_content):
    # 院長キーワード検索
    keywords = ['院長', '理事長', 'Dr.']
    for keyword in keywords:
        if keyword in html_content:
            idx = html_content.find(keyword)
            context = html_content[max(0, idx-50):idx+100]
            name = clean_name(context)
            return name
    return None

def clean_name(text):
    # 敬称削除
    for honorific in ['Dr.', '先生', '医学博士']:
        text = text.replace(honorific, '')
    return text.strip()
```

### パターン2: 公開検索エンジンから検索

**流れ**:
```
WebSearch → 「[医院名] 院長」で検索 → スニペット取得 → 院長名抽出 → 氏名確定
```

**検索クエリ**: `{医院名} 院長`

**コード例**:
```python
def search_for_director(clinic_name):
    query = f"{clinic_name} 院長"
    results = websearch(query)

    if results:
        snippet = results[0]['snippet']
        if '院長' in snippet:
            # キーワード周辺テキスト抽出
            idx = snippet.find('院長')
            name = clean_name(snippet[idx:idx+50])
            return name

    return None
```

### パターン3: 見つからない場合

**記録内容**: `不明`

---

## 出力ファイル形式

### CSV形式

**ファイルパス**:
```
/Users/yuichi/AIPM/aipm_v0/Flow/202601/2026-01-04/director_names_batch_2.csv
```

**カラム定義**:

| カラム | 説明 | 例 |
|--------|------|-----|
| `医院名` | 医院の正式名称 | むらつ歯科クリニック |
| `院長名` | 検索で見つかった院長名（敬称なし） | 村津太郎 |

### CSV例

```csv
医院名,院長名
むらつ歯科クリニック,村津太郎
博多矯正歯科KITTE博多院,田中花子
Oh my teeth 福岡博多矯正歯科,不明
MC天神こが歯科・矯正歯科,鈴木健太
Sagan歯科こども歯科医院,佐藤次郎
...（107行まで）
```

### 名前のバリエーション処理

| 入力 | 処理 | 出力 |
|------|------|------|
| `Dr. 山田太郎` | 敬称削除 | `山田太郎` |
| `山田太郎先生` | 敬称削除 | `山田太郎` |
| `山田太郎（代表）` | 括弧削除 | `山田太郎` |
| `山田太郎、田中花子` | 複数候補→1名 | `山田太郎` |
| 見つからない | デフォルト値 | `不明` |

---

## 実行チェックリスト

### 実行前の準備

- [ ] CSVファイルの場所確認: `/Users/yuichi/AIPM/aipm_v0/Flow/202601/2026-01-03/歯科医院リスト...csv.csv`
- [ ] 行108-214の医院数確認: 107医院
- [ ] 出力ディレクトリ作成確認: `/Users/yuichi/AIPM/aipm_v0/Flow/202601/2026-01-04/`
- [ ] 実装方法の選択: 方法A（手動）または 方法B（自動）
- [ ] インターネット接続確認

### 実行中の監視

- [ ] WebFetch/WebSearchの動作状況
- [ ] エラー発生状況
- [ ] 2秒インターバルの遵守
- [ ] 処理進捗の確認

### 実行後の検証

- [ ] 出力CSVファイルの存在確認
- [ ] 行数確認（107医院 + ヘッダー = 108行）
- [ ] ランダムサンプル確認（5-10医院）
- [ ] 「不明」の件数確認（20-25件程度が目安）
- [ ] 敬称が削除されているか確認
- [ ] ファイルエンコーディング確認（UTF-8）

---

## 期待される成果

### 統計情報

| 指標 | 期待値 | 説明 |
|------|--------|------|
| **処理医院数** | 107 | CSVのすべての行 |
| **成功率** | 75-80% | WebFetch/WebSearch両方で成功 |
| **部分成功** | 5-10% | WebSearchのみで成功 |
| **失敗（不明）** | 15-20% | どちらでも見つからない |
| **実行時間** | 8-10分 | 方法Aの場合 |

### 地域別分布

```
九州地方: 43医院
東北地方: 64医院
合計: 107医院
```

### 品質指標

```
敬称削除率: 100%
複数名処理: 100%
「不明」の妥当性: 90%以上
```

---

## トラブルシューティング

### 問題1: WebFetchがタイムアウト

**症状**: 医院のWebサイトが応答しない

**対応**:
```
1. 2-3秒待機して再試行
2. 再度失敗したらWebSearchにフォールバック
3. WebSearchでも見つからなければ「不明」
```

### 問題2: ページの言語が変わる

**症状**: 英語サイトから日本語が取得できない

**対応**:
```
1. URLの言語パラメータを確認（?lang=ja 等）
2. 英語ページから推測（院長名は日本語の可能性が高い）
3. WebSearchで日本語検索を追加
```

### 問題3: ネットワークエラー

**症状**: 接続エラーが多い

**対応**:
```
1. インターネット接続を確認
2. APIレート制限に達していないか確認
3. 一時的に2秒待機を3-4秒に延長
```

### 問題4: 院長名抽出ロジックの誤検出

**症状**: 院長名ではない他の人物名が抽出される

**対応**:
```
1. キーワード周辺のコンテキスト拡大（50文字 → 100文字）
2. 複数キーワード（院長、理事長、代表等）の組み合わせ
3. HTMLの構造を利用（<div class="director"> 等）
```

---

## 参考情報

### WebFetch 使用方法

```markdown
/fetch [URL]

例:
/fetch https://muratsu-dc.jp/
```

**出力**: Markdown形式に変換されたページ内容

### WebSearch 使用方法

```markdown
/search [検索クエリ]

例:
/search むらつ歯科クリニック 院長
```

**出力**: 複数の検索結果（タイトル、URL、スニペット）

---

## 完成基準

このタスクが完了したと判断する基準:

- ✅ 107医院すべてがCSVに記録されている
- ✅ 「不明」が20%程度（21医院程度）である
- ✅ すべての敬称（Dr., 先生等）が削除されている
- ✅ 複数候補がある場合、1名のみが記録されている
- ✅ ファイルがUTF-8で保存されている
- ✅ 実行時間が10分以内である

---

## 関連ドキュメント

| ファイル | 内容 | 使用時機 |
|---------|------|--------|
| **DIRECTOR_COLLECTION_WORKFLOW.md** | 詳細ワークフロー | 全体像把握 |
| **implement_director_collection.md** | 実装ガイド・コード例 | 実装参考 |
| **collect_directors_batch_2.py** | Python実行スクリプト | 自動処理 |
| **director_names_batch_2.csv** | 出力ファイル（未作成） | 最終成果物 |

---

## 次のステップ

### 1. 医院ごとの検証

実行後、ランダムに選択した10医院について Google 検索で院長名を確認し、精度を検証します。

### 2. データ品質評価

```
精度評価:
- 完全一致: X%
- 部分一致: Y%
- 誤検出: Z%
```

### 3. 本番運用への移行

検証結果が良好な場合、結果を Stock ディレクトリに移動し、本番利用をスタートします。

---

## 実行開始

このドキュメントを理解した後、以下のいずれかを実行してください:

### 方法A: 手動逐次実行
```markdown
1. DIRECTOR_COLLECTION_WORKFLOW.md を参照
2. 最初の5医院をテストで確認
3. パターンを学習
4. 残り102医院を逐次処理
```

### 方法B: 自動バッチ処理
```bash
python3 /Users/yuichi/AIPM/aipm_v0/Flow/202601/2026-01-04/collect_directors_batch_2.py
```

---

**実行日**: 2026-01-04
**実行者**: Claude Code
**推定完了時刻**: 2026-01-04 [実行時間]分後
**出力ファイル**: `director_names_batch_2.csv`

---

## ドキュメント構成図

```
README.md（このファイル）
├─ タスク概要
├─ ファイル構成と説明
├─ 実行方法（方法A/B）
├─ 院長名抽出ロジック
├─ 出力ファイル形式
├─ チェックリスト
├─ 期待成果
├─ トラブルシューティング
└─ 参考情報

DIRECTOR_COLLECTION_WORKFLOW.md
├─ タスク概要（詳細版）
├─ 医院情報リスト（107医院）
├─ 実装手順の詳細
├─ パフォーマンス予測
└─ 品質管理基準

implement_director_collection.md
├─ 実装方針（逐次 vs 並列）
├─ WebFetch/WebSearch パターン
├─ 院長名抽出ロジック（コード例）
├─ Python実装例
├─ 検証方法
└─ トラブルシューティング

collect_directors_batch_2.py
├─ 107医院のデータ定義
├─ CSV読み込み/書き込み処理
└─ エラーハンドリングフレームワーク
```

---

**作成日**: 2026-01-04
**バージョン**: 1.0
**ステータス**: 準備完了 → 実行待機中
