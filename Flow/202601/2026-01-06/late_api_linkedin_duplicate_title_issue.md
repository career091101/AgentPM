# Late API LinkedIn投稿 - タイトル重複問題

## 発見日時
2026-01-06 07:18

## 問題の概要
LateAPIを経由してLinkedInに投稿されたコンテンツにおいて、**投稿の1行目（タイトル部分）が2回重複して表示される**問題が発生。

## 具体的な症状
### 期待される表示
```
OpenAIとNVIDIAが仕掛けた「200兆円の循環投資」、ITバブルの再来か

日本経済新聞が報じた衝撃のレポート。
OpenAIが約200兆円規模のインフラ投資を発表し、その資金調達手法が「売り手と買い手で資金が循環する...
```

### 実際の表示（問題）
```
OpenAIとNVIDIAが仕掛けた「200兆円の循環投資」、ITバブルの再来か

OpenAIとNVIDIAが仕掛けた「200兆円の循環投資」、ITバブルの再来か。

日本経済新聞が報じた衝撃のレポート。
OpenAIが約200兆円規模のインフラ投資を発表し、その資金調達手法が「売り手と買い手で資金が循環する...
```

👆 **1行目と3行目が同じ内容で重複**

## 影響範囲
- **プラットフォーム**: LinkedIn（Late API経由投稿）
- **投稿タイプ**: 長文テキスト投稿
- **発生頻度**: 要調査（単発 or 恒常的）

## 推定原因（仮説）

### 仮説1: Late APIのLinkedIn投稿フォーマット処理の問題
- Late APIがLinkedIn投稿を処理する際、タイトル部分を自動抽出して本文の先頭に挿入している可能性
- 元の投稿テキストに既にタイトルが含まれている場合、重複が発生

### 仮説2: 投稿生成スクリプト側の問題
- SNS投稿生成スクリプト（`generate-sns-posts-takano`等）がタイトルを2回含めてしまっている可能性
- LinkedIn向けフォーマット処理時のバグ

### 仮説3: Late APIのマルチライン処理のバグ
- Late APIが複数行テキストを処理する際、1行目を特別扱いして重複させている可能性

## 調査すべき項目

### 1. 投稿元データの確認
- [ ] 生成されたLinkedIn投稿の元テキストファイルを確認
- [ ] 元データの時点で重複しているか、Late API経由で重複が発生しているかを特定

**確認対象ファイル**:
```bash
Stock/programs/副業/projects/SNS/contents/linkedin/
Stock/programs/副業/projects/SNS/outputs/
```

### 2. Late API投稿スクリプトの確認
- [ ] `late_api_post.py` または関連スクリプトのLinkedIn投稿処理部分を確認
- [ ] タイトル抽出・挿入ロジックの有無を確認

**確認対象スクリプト**:
```bash
Stock/programs/副業/projects/SNS/scripts/late_api_post.py
Stock/programs/副業/projects/SNS/scripts/late_api_multi_post_v2.py
```

### 3. Late API仕様の確認
- [ ] Late APIの公式ドキュメントでLinkedIn投稿のフォーマット仕様を確認
- [ ] タイトル自動抽出機能の有無を確認
- [ ] マルチライン投稿の推奨フォーマットを確認

### 4. 再現テスト
- [ ] 最小限のテストケースでLate API経由のLinkedIn投稿を実行
- [ ] 重複が再現するか確認

**テストケース例**:
```python
# テスト投稿1: タイトルのみ
content = "これはテストタイトルです"

# テスト投稿2: タイトル + 本文
content = """これはテストタイトルです

これは本文の1行目です。
これは本文の2行目です。"""

# テスト投稿3: 空行なし
content = """これはテストタイトルです
これは本文の1行目です。"""
```

## 修正方針（案）

### オプション1: Late API側の仕様に合わせる
- Late APIがタイトルを自動抽出する仕様の場合、投稿テキストからタイトル部分を削除
- 1行目を空白行にするなど、Late APIのフォーマット要件に従う

### オプション2: 投稿生成スクリプトの修正
- LinkedIn向けフォーマット処理時に、タイトル重複が発生しないようロジックを修正
- タイトルと本文を明確に分離して管理

### オプション3: Late API投稿スクリプトの前処理追加
- Late API送信前に、重複チェック＆削除処理を追加
- 連続する同一行を検出して自動削除

## 優先度
**P1（高）** - ユーザー体験に直接影響、投稿品質の低下

## 次のアクション
1. 投稿元データの確認（元データ時点での重複有無の特定）
2. Late API投稿スクリプトのコードレビュー
3. Late API公式ドキュメントの確認
4. 再現テストの実施
5. 修正方針の決定と実装

## 関連ファイル
- スクリーンショット: `Flow/202601/2026-01-05/スクリーンショット 2026-01-06 7.18.54.png`
- 投稿スクリプト: `Stock/programs/副業/projects/SNS/scripts/late_api_post.py`
- 投稿生成スキル: `.claude/skills/sns-automation/generate-sns-posts-takano/`

## 参考情報
- Late API公式ドキュメント: [要確認]
- LinkedIn投稿フォーマット仕様: [要確認]

---

**作成日**: 2026-01-06
**報告者**: User（スクリーンショット提供）
**ステータス**: 調査待ち
