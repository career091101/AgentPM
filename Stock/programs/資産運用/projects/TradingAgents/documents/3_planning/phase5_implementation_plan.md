# Phase 5実装計画: 実運用準備

**作成日**: 2026-01-01
**プロジェクト**: TradingAgents - 日経平均先物トレード戦略システム
**フェーズ**: Phase 5 - 実運用準備・最終検証

---

## 1. Phase 5の目的

Phase 4で構築した検証基盤を使用して、**実運用に向けた最終準備**を完了する。実データでの包括的検証、週次レポート自動生成、実運用シミュレーションを実施し、システムの実用性を確認する。

### Phase 4の成果（継承するもの）

- ✅ RealDataLoader実装（yfinance対応）
- ✅ RegimeSpecificOptimizer（Bull/Bear/Sideways最適化）
- ✅ AdaptiveStrategy（動的レジーム切り替え）
- ✅ WalkForwardAnalyzer（時系列クロスバリデーション）
- ✅ 統合テスト完了（6/6成功）
- ✅ 3段階KPI目標提案（実データ駆動）

### Phase 5で追加する価値

1. **実データでの包括的検証**: 日経225実データ（2020-2025）での完全バックテスト
2. **週次戦略レポート自動生成**: 実運用を想定した週次レポート作成
3. **実運用シミュレーション**: 最新データでのリアルタイム動作確認
4. **KPI目標の最終確定**: プロジェクト憲章への標準目標反映
5. **運用マニュアル作成**: システム運用手順のドキュメント化

---

## 2. 実装項目と優先度

### 優先度1: 実データバックテスト実行（Agent 1）

**目的**: 日経225実データ（2020-2025）での包括的バックテスト実行と検証

**実装内容**:

1. **Python環境確認・準備**
   - Python 3.10+環境の確認（yfinance要件）
   - 必要に応じてvenv作成
   - yfinanceインストール（`pip install yfinance`)

2. **実データ取得・検証**
   - `scripts/run_real_data_backtest.py`実行
   - 日経225データ（^N225, 2020-2025）取得
   - データ品質メトリクス確認
   - キャッシュ保存

3. **包括的バックテスト実行**
   - Train期間: 2020-2022（3年）
   - Test期間: 2023-2025（3年）
   - 全期間（2020-2025）統合バックテスト
   - レジーム別パフォーマンス分析

4. **Walk-forward分析実行**
   - `scripts/analyze_kpi_statistics.py`実行
   - 全ウィンドウ（約19-20個）でのWalk-forward分析
   - KPI統計計算（中央値、四分位範囲）
   - 達成確率評価

5. **レジーム別最適化検証**
   - `scripts/run_regime_backtest.py`実行
   - Bull/Bear/Sideways各レジーム期間の抽出
   - レジーム別最適パラメータ確定
   - 動的切り替え戦略 vs 固定戦略比較

6. **結果レポート生成**
   - `data/results/phase5_real_data_validation_report.md`
   - 全KPI評価（Phase 4目標との比較）
   - レジーム別パフォーマンス詳細
   - Walk-forward分析結果
   - 可視化（Equity curve, Drawdown, Regime performance）

**成功基準**:
- 実データ取得成功（2020-2025、約1260営業日）
- Walk-forward全ウィンドウの80%以上で正のリターン
- Train-Test乖離30%以内
- 標準KPI目標（Q50）の達成確率50%以上
- レジーム別最適化が固定戦略よりSharpe ratio +10%以上改善

**推定作業時間**: 6-8時間（エージェント実行）

---

### 優先度2: 週次戦略レポート自動生成（Agent 2）

**目的**: 実運用を想定した週次戦略レポートの自動生成システム構築

**実装内容**:

1. **週次レポートテンプレート作成**
   - `templates/weekly_strategy_report_template.md`
   - エグゼクティブサマリー（週間リターン、勝率、Sharpe ratio）
   - 週次トレード詳細（エントリー/イグジット、損益）
   - 現在のレジーム状態（Bull/Bear/Sideways）
   - 次週の戦略推奨（エントリーポイント、リスク管理）
   - パフォーマンス可視化（週次Equity curve、Drawdown）

2. **レポート自動生成スクリプト作成**
   - `scripts/generate_weekly_report.py`
   - 最新1週間データの取得
   - シグナル生成（AdaptiveStrategy使用）
   - パフォーマンス計算
   - レジーム検出
   - テンプレートへのデータ挿入
   - PDF/HTML出力

3. **可視化機能拡張**
   - 週次Equity curveグラフ生成
   - 週次Drawdownグラフ生成
   - レジーム推移グラフ生成
   - トレード詳細テーブル生成

4. **スケジュール実行設定**
   - cron/スケジューラー設定例作成
   - 毎週月曜朝8時実行（前週分析）
   - エラーハンドリング（データ取得失敗時）
   - メール通知機能（オプション）

5. **サンプルレポート生成**
   - 最新週（2025-12-23〜2025-12-27）のサンプルレポート
   - `data/results/weekly_report_20251227.md`
   - PDF版: `data/results/weekly_report_20251227.pdf`

**成功基準**:
- 週次レポートテンプレート完成
- 自動生成スクリプト動作確認
- サンプルレポート生成成功
- 可視化3種類（Equity/Drawdown/Regime）生成
- 実行時間5分以内

**推定作業時間**: 6-8時間（エージェント実行）

---

### 優先度3: 実運用シミュレーション（Agent 3）

**目的**: 最新データでのリアルタイム動作確認とエラーハンドリング強化

**実装内容**:

1. **最新データ検証スクリプト作成**
   - `scripts/validate_latest_data.py`
   - 最新30日間のデータ取得
   - データ品質チェック（欠損値、異常値）
   - レジーム検出動作確認
   - シグナル生成動作確認

2. **リアルタイムシミュレーション**
   - `scripts/run_live_simulation.py`
   - 最新データでのシグナル生成
   - エントリー/イグジット判定
   - ポジション管理シミュレーション
   - リスク管理チェック（Stop-loss/Take-profit）

3. **エラーハンドリング強化**
   - データ取得失敗時のリトライ機構
   - API制限対応（yfinance制限回避）
   - ネットワークエラー対応
   - データ欠損時の補完ロジック
   - 異常値検出時のアラート

4. **パフォーマンスモニタリング**
   - `src/utils/performance_monitor.py`
   - 実行時間測定
   - メモリ使用量監視
   - API呼び出し回数カウント
   - エラーログ記録

5. **運用マニュアル作成**
   - `documents/5_operations/operation_manual.md`
   - システム起動手順
   - 週次レポート生成手順
   - トラブルシューティング
   - エラーコード一覧
   - メンテナンス手順

6. **結果レポート**
   - `data/results/phase5_live_simulation_report.md`
   - 最新データでのシミュレーション結果
   - エラーハンドリング動作確認
   - パフォーマンスメトリクス
   - 運用上の注意点

**成功基準**:
- 最新データ取得・検証成功
- リアルタイムシミュレーション動作確認
- エラーハンドリング5パターン以上実装
- 運用マニュアル完成
- シミュレーション成功率90%以上

**推定作業時間**: 6-8時間（エージェント実行）

---

## 3. 並列実行計画

### Batch 1: 3エージェント同時起動（推奨）

```
Agent 1 (実データバックテスト): model=sonnet, 6-8時間
Agent 2 (週次レポート自動生成): model=sonnet, 6-8時間
Agent 3 (実運用シミュレーション): model=sonnet, 6-8時間

総実行時間: 6-8時間（最遅エージェントに依存）
効率化率: 67%短縮（シーケンシャル18-24時間 → 並列6-8時間）
```

### 並列実行の前提条件

- 各エージェントは独立動作（共有ファイルなし）
- Agent 1の実データがAgent 2/3で活用可能（後続統合で使用）
- 最終統合テストはBatch 1完了後に実施

---

## 4. 成果物一覧

### コードモジュール

1. `src/utils/performance_monitor.py` - パフォーマンスモニタリング
2. `scripts/generate_weekly_report.py` - 週次レポート自動生成
3. `scripts/validate_latest_data.py` - 最新データ検証
4. `scripts/run_live_simulation.py` - リアルタイムシミュレーション
5. `templates/weekly_strategy_report_template.md` - 週次レポートテンプレート

### テストコード

1. `src/tests/test_weekly_report_generator.py` - 週次レポート生成テスト
2. `src/tests/test_live_simulation.py` - リアルタイムシミュレーションテスト
3. `src/tests/test_performance_monitor.py` - パフォーマンスモニターテスト
4. `src/tests/test_phase5_integration.py` - Phase 5統合テスト

### ドキュメント

1. `data/results/phase5_real_data_validation_report.md` - 実データ検証レポート
2. `data/results/phase5_live_simulation_report.md` - 実運用シミュレーションレポート
3. `data/results/weekly_report_20251227.md` - サンプル週次レポート
4. `documents/5_operations/operation_manual.md` - 運用マニュアル
5. `documents/3_planning/phase5_completion_summary.md` - Phase 5完了サマリー
6. `documents/1_initiating/project_charter.md` (更新) - KPI目標最終確定

---

## 5. Phase 5成功基準

### 必須達成項目（100%必須）

1. ✅ 実データバックテスト完了（2020-2025、5年間）
2. ✅ Walk-forward分析完了（全ウィンドウで検証）
3. ✅ レジーム別最適化検証完了（動的戦略 vs 固定戦略）
4. ✅ 週次レポート自動生成システム完成
5. ✅ 実運用シミュレーション成功
6. ✅ 運用マニュアル完成
7. ✅ 統合テスト成功率80%以上

### KPI目標（最終確定）

**標準目標（Q50、達成確率50%）** ← プロジェクト憲章に反映:
- 週間平均リターン: 2.0%
- 勝率: 55%
- プロフィットファクター: 1.4
- 最大ドローダウン: -10%
- シャープレシオ: 0.65

**実データ検証での評価基準**:
- 標準目標（Q50）の達成確率50%±10%
- Train-Test乖離30%以内
- Walk-forward全ウィンドウの80%以上で正のリターン

### 品質基準

1. **実データ検証**: 実データ完全性90%以上
2. **レポート生成**: 自動生成成功率95%以上
3. **シミュレーション**: 実運用シミュレーション成功率90%以上
4. **エラーハンドリング**: 5パターン以上実装
5. **コードカバレッジ**: 80%以上
6. **ドキュメント完全性**: 全成果物が揃っている

---

## 6. リスクと対策

### リスク1: yfinanceデータ取得失敗

**確率**: 中
**影響度**: 高
**対策**:
- リトライ機構実装（最大3回）
- 複数データソース対応（yfinance + alpaca等）
- ローカルキャッシュ活用
- エラー時の代替シナリオ（サンプルデータ使用）

### リスク2: 実データでKPI目標未達

**確率**: 中（Phase 4デモで一部未達）
**影響度**: 中（目標再調整で対応可）
**対策**:
- Phase 4で既に目標を実データ駆動に調整済み
- 標準目標（Q50）は達成確率50%設計
- 未達の場合は保守的目標（Q25）に下方修正

### リスク3: レジーム誤判定による損失

**確率**: 中
**影響度**: 中
**対策**:
- レジーム切り替え安定性確保（最低5日間一貫性）
- 信頼度閾値60%以上
- 誤判定時の損失を-5%以内に抑制（Phase 4設計済み）

### リスク4: 実運用シミュレーションエラー

**確率**: 中
**影響度**: 中
**対策**:
- 包括的エラーハンドリング実装
- デバッグモード追加
- エラーログ詳細記録
- フォールバック機構

---

## 7. Phase 6への引継ぎ事項

Phase 5完了後、Phase 6（実運用開始）への引継ぎ内容:

1. **確定した戦略パラメータ**
   - レジーム別最適パラメータ（実データ検証済み）
   - 動的切り替え戦略の設定

2. **最終KPI目標**
   - 標準目標（Q50）をプロジェクト憲章に反映
   - 達成確率50%の現実的な目標

3. **運用システム**
   - 週次レポート自動生成スクリプト
   - 運用マニュアル
   - エラーハンドリング機構

4. **実運用準備完了証明**
   - Phase 5完了証明書
   - 実データ検証レポート
   - 実運用シミュレーション成功証明

---

## 8. タイムライン

| 作業項目                     | 担当       | 期間      | ステータス |
| ---------------------------- | ---------- | --------- | ---------- |
| Phase 5計画作成              | Claude     | 1時間     | ✅ 完了    |
| Agent 1: 実データバックテスト | Subagent 1 | 6-8時間   | 🔄 準備中  |
| Agent 2: 週次レポート自動生成 | Subagent 2 | 6-8時間   | 🔄 準備中  |
| Agent 3: 実運用シミュレーション | Subagent 3 | 6-8時間   | 🔄 準備中  |
| 統合テスト                   | Claude     | 2-3時間   | 予定       |
| 最終ドキュメント作成         | Claude     | 2時間     | 予定       |

**総実行時間（並列）**: 6-8時間
**Phase 5完了予定日**: 2026-01-01

---

## 9. 承認とサインオフ

- [ ] Phase 5実装計画承認
- [ ] 並列エージェント実行開始承認
- [ ] Phase 5完了承認（実装後）
- [ ] Phase 6（実運用開始）移行承認

---

## 変更履歴

| バージョン | 日付       | 変更内容       |
| ---------- | ---------- | -------------- |
| 1.0        | 2026-01-01 | Phase 5計画策定 |
