# Facebook Graph API トークン取得 - 超詳細ガイド

## 所要時間: 5分

---

## ステップ1: Facebook Developersにアクセス（1分）

### 1-1. ブラウザで以下のURLを開く

```
https://developers.facebook.com/apps
```

### 1-2. ログイン

- 個人のFacebookアカウントでログイン
- 初めての場合「スタート」ボタンが表示される → クリック
- 利用規約に同意
- 電話番号認証（必要な場合のみ）

---

## ステップ2: アプリを作成（2分）

### 2-1. 「アプリを作成」ボタンをクリック

画面右上の緑色のボタンです。

### 2-2. アプリタイプを選択

**重要**: 以下を選択してください

1. 「**その他**」を選択
2. 「次へ」をクリック

### 2-3. ユースケースを選択

1. 「**Consumer**」を選択
2. 「次へ」をクリック

### 2-4. アプリ情報を入力

| 項目 | 入力内容 |
|------|---------|
| アプリ名 | `My Personal Analytics` |
| アプリの連絡先メールアドレス | あなたのメールアドレス |
| ビジネスポートフォリオ | 「作成しない」を選択 |

### 2-5. 「アプリを作成」をクリック

- CAPTCHAが表示される → 完了
- アプリダッシュボードに移動

---

## ステップ3: Graph APIエクスプローラーでトークン生成（2分）

### 3-1. Graph APIエクスプローラーにアクセス

新しいタブで以下のURLを開く：

```
https://developers.facebook.com/tools/explorer/
```

### 3-2. アプリを選択

画面右上の「Meta App」ドロップダウンをクリック

**重要**: 「Graph API Explorer」ではなく、先ほど作成した「**My Personal Analytics**」を選択

### 3-3. 権限を追加

#### 手順:
1. 「User Token」の右にある「**Generate Access Token**」ボタンをクリック
2. ポップアップが表示される
3. 左側の「**Permissions**」タブをクリック
4. 検索ボックスに以下を1つずつ入力して追加:

**追加する権限**:
- ✅ `user_posts` - 自分の投稿を読み取り
- ✅ `user_photos` - 自分の写真を読み取り
- ✅ `user_videos` - 自分の動画を読み取り

#### 確認方法:
チェックマークが付いていることを確認

#### 次へ:
5. 「**Generate Access Token**」ボタン（青色）をクリック

### 3-4. Facebookログイン・権限許可

1. Facebookログイン画面が表示される（既にログイン済みの場合はスキップ）
2. 権限の許可画面が表示される:
   - 「〇〇さんとして続行」
   - 権限の説明が表示される
3. 「**続行**」ボタンをクリック
4. 「**完了**」をクリック

### 3-5. トークンをコピー

#### 重要: この画面でトークンが表示されます

1. 「User Access Token」フィールドに長い文字列が表示される
   - 形式: `EAAxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
   - 長さ: 200文字程度
2. フィールドの右側にある「**Copy**」アイコンをクリック
3. トークンがクリップボードにコピーされる

**⚠️ 重要**: このトークンは秘密にしてください！

---

## ステップ4: スクリプトに設定（1分）

### 4-1. ターミナルでスクリプトを編集

```bash
cd /Users/yuichi/AIPM/aipm_v0/Stock/programs/副業/projects/SNS/scripts
nano facebook_personal_analytics.py
```

### 4-2. ACCESS_TOKENを設定

15行目あたりの以下の行を探す:

```python
ACCESS_TOKEN = "YOUR_ACCESS_TOKEN_HERE"
```

これを以下のように変更（コピーしたトークンを貼り付け）:

```python
ACCESS_TOKEN = "EAAxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"  # コピーしたトークンを貼り付け
```

### 4-3. 保存して閉じる

- **Ctrl + O** → Enterキー → **Ctrl + X**

---

## ステップ5: 実行（1分）

```bash
python3 facebook_personal_analytics.py
```

### 期待される出力:

```
🚀 Facebook個人アカウント アナリティクス取得開始

================================================================================
1. 接続テスト
================================================================================
🔍 ユーザー情報取得中...
✅ ユーザー: 佐藤 優一

================================================================================
2. 投稿データ取得
================================================================================
📊 Facebook個人投稿データ取得中...
✅ 25件の投稿を取得しました

...
```

---

## トラブルシューティング

### エラー1: "Invalid OAuth access token"

**原因**: トークンが間違っている、または期限切れ

**解決策**:
1. ステップ3に戻る
2. 新しいトークンを生成
3. スクリプトを再度編集

---

### エラー2: "Permissions error"

**原因**: 権限が不足している

**解決策**:
1. Graph APIエクスプローラーに戻る
2. 「Permissions」タブで以下を確認:
   - ✅ user_posts
   - ✅ user_photos
   - ✅ user_videos
3. 不足している場合は追加して「Generate Access Token」を再実行

---

### エラー3: "An unknown error occurred"

**原因**: Facebookアカウントに投稿がない

**解決策**:
- Facebookに1件以上投稿してから再実行

---

## トークンの有効期限

**短期トークン**: 1-2時間で期限切れ

### 長期トークンの取得（60日間有効）

必要に応じて以下のコマンドで長期トークンに変換できます:

```bash
# アプリIDとアプリシークレットが必要
# Facebook Developers → アプリダッシュボード → 設定 → ベーシック で確認

curl -i -X GET "https://graph.facebook.com/v19.0/oauth/access_token?grant_type=fb_exchange_token&client_id=YOUR_APP_ID&client_secret=YOUR_APP_SECRET&fb_exchange_token=YOUR_SHORT_LIVED_TOKEN"
```

---

## 次のステップ

トークン取得後:

1. **スクリプト実行**:
   ```bash
   python3 facebook_personal_analytics.py
   ```

2. **出力確認**:
   - CSVファイル: `data/facebook_personal_analytics_YYYYMMDD_HHMMSS.csv`
   - JSONファイル: `data/facebook_personal_analytics_YYYYMMDD_HHMMSS.json`

3. **定期実行**（オプション）:
   cronで自動実行設定も可能

---

## 参考スクリーンショット説明

### Graph APIエクスプローラー画面

```
┌─────────────────────────────────────────────────────────────┐
│ Meta App: [My Personal Analytics ▼]                         │
├─────────────────────────────────────────────────────────────┤
│ User Access Token: [Generate Access Token]                  │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ EAAxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx [Copy]      │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ GET ▼  /me                                                  │
│        /me/posts                                            │
│        /me/photos                                           │
└─────────────────────────────────────────────────────────────┘
```

### 権限選択画面

```
┌─────────────────────────────────────────────────────────────┐
│ Generate Access Token                                        │
├─────────────────────────────────────────────────────────────┤
│ [Permissions] [Settings]                                     │
├─────────────────────────────────────────────────────────────┤
│ Search permissions...                                        │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ✅ user_posts      - 自分の投稿を読み取り              │ │
│ │ ✅ user_photos     - 自分の写真を読み取り              │ │
│ │ ✅ user_videos     - 自分の動画を読み取り              │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                              │
│                     [Generate Access Token]                  │
└─────────────────────────────────────────────────────────────┘
```

---

**質問があれば、どのステップで詰まったか教えてください！**
