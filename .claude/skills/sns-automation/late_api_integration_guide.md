# Late APIçµ±åˆè©³ç´°ã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯SNSè‡ªå‹•åŒ–ã‚¹ã‚­ãƒ«ã®Phase 4ï¼ˆLinkedInäºˆç´„æŠ•ç¨¿ï¼‰ã§ä½¿ç”¨ã™ã‚‹Late APIçµ±åˆã®è©³ç´°æƒ…å ±ã‚’è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚

**å‚ç…§å…ƒ**: `.claude/skills/sns-automation/SKILL.md` Phase 4

---

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

**ãƒ‘ã‚¹**: `Stock/programs/å‰¯æ¥­/projects/SNS/config/late_api_config.json`

```json
{
  "api_key": "sk_...",
  "base_url": "https://getlate.dev/api/v1",
  "accounts": {
    "linkedin": {"accountId": "...", "platform": "linkedin"},
    "twitter": {"accountId": "...", "platform": "twitter"},
    "threads": {"accountId": "...", "platform": "threads"},
    "facebook": {"accountId": "...", "platform": "facebook"}
  }
}
```

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°éšå±¤

```python
LateAPIError (åŸºåº•ã‚¯ãƒ©ã‚¹)
â”œâ”€â”€ AuthenticationError (401)  # APIã‚­ãƒ¼ç„¡åŠ¹/æœŸé™åˆ‡ã‚Œ â†’ è¨­å®šç¢ºèª
â”œâ”€â”€ RateLimitError (429)       # ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…é â†’ 1æ™‚é–“å¾Œãƒªãƒˆãƒ©ã‚¤
â””â”€â”€ ãã®ä»–HTTPã‚¨ãƒ©ãƒ¼
    â”œâ”€â”€ 400: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸æ­£ â†’ è©³ç´°ãƒ­ã‚° + äººé–“ç¢ºèª
    â””â”€â”€ 500+: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ â†’ ãƒªãƒˆãƒ©ã‚¤å¾Œåœæ­¢
```

### ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥
- **401**: ãƒªãƒˆãƒ©ã‚¤ãªã—ã€å³æ™‚åœæ­¢
- **429**: 1æ™‚é–“å¾Œã«1å›ãƒªãƒˆãƒ©ã‚¤
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: 3å›ãƒªãƒˆãƒ©ã‚¤å¾Œã‚¹ã‚­ãƒƒãƒ—

### Late APIã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰åˆ¥å¯¾å¿œ

| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | å¯¾å¿œ |
|------------|------|
| **401 Unauthorized** | APIè¨­å®šç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º + è©²å½“æ¡ˆã‚¹ã‚­ãƒƒãƒ— |
| **429 Rate Limit** | è©²å½“æ¡ˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆæ‰‹å‹•æŠ•ç¨¿ç”¨Markdownç”Ÿæˆï¼‰ |
| **400 Bad Request** | ã‚¨ãƒ©ãƒ¼è©³ç´°ãƒ­ã‚° + è©²å½“æ¡ˆã‚¹ã‚­ãƒƒãƒ— |
| **Network Timeout** | è©²å½“æ¡ˆã‚¹ã‚­ãƒƒãƒ— |

**é‡è¦**: éƒ¨åˆ†æˆåŠŸã‚’è¨±å®¹ã€‚1æ¡ˆã§ã‚‚æˆåŠŸã™ã‚Œã°Phase 4ã¯æˆåŠŸæ‰±ã„ã€‚

---

## ã‚¹ãƒ¬ãƒƒãƒ‰åˆ†å‰²ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### Xã‚¹ãƒ¬ãƒƒãƒ‰ï¼ˆ140æ–‡å­—åˆ¶é™ï¼‰

**åˆ†å‰²å„ªå…ˆé †ä½**:
1. æ®µè½åˆ†å‰²ï¼ˆ`\n\n`ï¼‰
2. å¥ç‚¹åˆ†å‰²ï¼ˆ`ã€‚`ï¼‰
3. èª­ç‚¹åˆ†å‰²ï¼ˆ`ã€`ï¼‰â€»æŸ”è»ŸåŸºæº–
4. å¼·åˆ¶åˆ†å‰²ï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰

**ç‰¹æ®Šãƒ«ãƒ¼ãƒ«**:
- 5ãƒ„ã‚¤ãƒ¼ãƒˆæœªæº€ã®å ´åˆã€æœ€é•·ãƒ„ã‚¤ãƒ¼ãƒˆã‚’è‡ªå‹•åˆ†å‰²
- 60æ–‡å­—ä»¥ä¸‹ã¯åˆ†å‰²ä¸å¯
- ç•ªå·è¡¨è¨˜ãƒãƒ¼ã‚¸ãƒ³: 10æ–‡å­—ï¼ˆ`(N/N)\n\n`ï¼‰

### Threadsã‚¹ãƒ¬ãƒƒãƒ‰ï¼ˆ500æ–‡å­—åˆ¶é™ï¼‰

**åˆ†å‰²å„ªå…ˆé †ä½**:
1. ã‚»ã‚¯ã‚·ãƒ§ãƒ³åŒºåˆ‡ã‚Šï¼ˆ`â”â”â”`ï¼‰
2. æ®µè½åˆ†å‰²ï¼ˆ`\n\n`ï¼‰
3. å¥ç‚¹åˆ†å‰²ï¼ˆ`ã€‚`ï¼‰
4. å¼·åˆ¶åˆ†å‰²ï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰

**ç‰¹æ®Šãƒ«ãƒ¼ãƒ«**:
- 3æŠ•ç¨¿ã«è‡ªå‹•èª¿æ•´
- æœ€çŸ­ãƒšã‚¢ã‚’çµ±åˆï¼ˆ3æŠ•ç¨¿æœªæº€ã®å ´åˆï¼‰
- æœ€é•·æŠ•ç¨¿ã‚’åˆ†å‰²ï¼ˆ3æŠ•ç¨¿è¶…éã®å ´åˆï¼‰

---

## ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥æœ€é©æŠ•ç¨¿æ™‚é–“ï¼ˆAsia/Tokyoï¼‰

```python
optimal_times = {
    "linkedin": "08:00",  # æœï¼ˆãƒ“ã‚¸ãƒã‚¹ã‚¿ã‚¤ãƒ ã€ER 20-30%å‘ä¸Šï¼‰
    "twitter": "12:00",   # æ˜¼ä¼‘ã¿ï¼ˆé«˜ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆï¼‰
    "threads": "20:00",   # å¤œï¼ˆãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ ï¼‰
    "facebook": "19:00"   # å¤•æ–¹ï¼ˆå¸°å®…å¾Œï¼‰
}
```

**ãƒˆãƒ”ãƒƒã‚¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«åŸºã¥ãæ—¥ä»˜ã‚ªãƒ•ã‚»ãƒƒãƒˆ**:
- 0 = ä»Šæ—¥ã€1 = æ˜æ—¥ã€2 = æ˜å¾Œæ—¥
- Top 3ãƒˆãƒ”ãƒƒã‚¯ã‚’3æ—¥é–“ã«åˆ†æ•£æŠ•ç¨¿

---

## ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰ãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„

**é‡è¦**: `content`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨`threadItems`ã¯æ’ä»–çš„ä½¿ç”¨

```json
// âœ… æ­£ã—ã„: ã‚¹ãƒ¬ãƒƒãƒ‰æŠ•ç¨¿
{
  "platforms": [{
    "platform": "twitter",
    "accountId": "...",
    "platformSpecificData": {
      "threadItems": [{"content": "1/5 ..."}]
    }
  }],
  "content": ""  // threadItemsä½¿ç”¨æ™‚ã¯ç©º
}

// âœ… æ­£ã—ã„: å˜ä¸€æŠ•ç¨¿
{
  "platforms": [{
    "platform": "linkedin",
    "accountId": "..."
  }],
  "content": "æŠ•ç¨¿å†…å®¹"
}
```

---

## å®Ÿè£…çŠ¶æ³ã¨ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®

| Phase | æ©Ÿèƒ½ | å®Ÿè£…çŠ¶æ³ | é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ« |
|-------|------|---------|-------------|
| **Phase 1** | åŸºæœ¬APIæŠ•ç¨¿ | âœ… å®Ÿè£…æ¸ˆã¿ | `scripts/late_api_post.py` |
| **Phase 3** | ã‚¹ãƒ¬ãƒƒãƒ‰åˆ†å‰² | âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆéª¨çµ„ã¿ï¼‰ | `split_for_twitter()`, `split_for_threads()` |
| **Phase 4** | ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚° | âœ… å®Ÿè£…æ¸ˆã¿ | `calculate_schedule()` |
| **Phase 5** | ã‚­ãƒ¥ãƒ¼ç®¡ç† | â³ éª¨çµ„ã¿ã®ã¿ | `create_post_queue()` |

---

## çµ±åˆææ¡ˆãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ï¼ˆå°†æ¥æ‹¡å¼µï¼‰

| ãƒ•ã‚§ãƒ¼ã‚º | æ©Ÿèƒ½ | é›£æ˜“åº¦ | å·¥æ•° | å„ªå…ˆåº¦ |
|---------|------|--------|------|--------|
| **Short-term (2-3æ—¥)** | ãƒãƒ«ãƒãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å±•é–‹ + ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚° | â­â­â˜†â˜†â˜† | 8-12h | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ |
| **Mid-term (1-2é€±)** | Xã‚¹ãƒ¬ãƒƒãƒ‰ + Threadså±•é–‹ | â­â­â­â˜†â˜† | 11-15h | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥â˜† |
| **Long-term (3-4é€±)** | ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥æœ€é©åŒ– + è¤‡æ•°ãƒˆãƒ”ãƒƒã‚¯å±•é–‹ | â­â­â­â­â˜† | 26-32h | ğŸ”¥ğŸ”¥ğŸ”¥â˜†â˜† |
| **Future (1-2ãƒ¶æœˆ)** | A/Bãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ– | â­â­â­â­â­ | 20-24h | ğŸ”¥ğŸ”¥â˜†â˜†â˜† |

**å‚ç…§**: `Flow/202601/2026-01-02/late_api_integration_proposals.md`

---

## å®Œå…¨å¤±æ•—æ™‚ã®å¯¾å¿œ

å…¨3æ¡ˆãŒå¤±æ•—ã—ãŸå ´åˆ:
1. å…¨æ¡ˆã®æ‰‹å‹•æŠ•ç¨¿ç”¨Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
2. è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
3. ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ©ã¯ç¶™ç¶šï¼ˆPhase 5ã¸é€²ã‚€ï¼‰

### Late APIå¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

Late APIãŒå¤±æ•—ã—ãŸæ¡ˆã«ã¤ã„ã¦ã¯ã€Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ:

```python
# Late APIå¤±æ•—æ¡ˆã®Markdownãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
failed_posts = [r for r in results if r["status"] == "error"]

if failed_posts:
    fallback_dir = "Stock/programs/å‰¯æ¥­/projects/SNS/data/manual_posts"
    os.makedirs(fallback_dir, exist_ok=True)

    for failed in failed_posts:
        variant_num = failed["variant"].replace("æ¡ˆ", "")
        fallback_path = f"{fallback_dir}/linkedin_{date}_variant{variant_num}.md"

        with open(fallback_path, "w", encoding="utf-8") as f:
            f.write(f"# LinkedInæŠ•ç¨¿ - {failed['variant']}\n\n")
            f.write(f"**äºˆå®šæŠ•ç¨¿æ—¥æ™‚**: {tomorrow_8am.strftime('%Y-%m-%d %H:%M JST')}\n\n")
            f.write(f"**Late APIã‚¨ãƒ©ãƒ¼**: {failed.get('error_message', 'Unknown')}\n\n")
            f.write("---\n\n")
            f.write(posts[int(variant_num)-1])

        print(f"ğŸ“ æ‰‹å‹•æŠ•ç¨¿ç”¨Markdownç”Ÿæˆ: {fallback_path}")
```

---

## å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

1. **æˆåŠŸæ™‚**: `Stock/programs/å‰¯æ¥­/projects/SNS/data/late_api_scheduled_{date}.json`
2. **å¤±æ•—æ™‚**: `Stock/programs/å‰¯æ¥­/projects/SNS/data/manual_posts/linkedin_{date}_variant{N}.md`

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- ãƒ¡ã‚¤ãƒ³SKILL: `@.claude/skills/sns-automation/SKILL.md`
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å…±é€š: `@.claude/skills/_shared/error_handling_patterns.md`
- çµ±åˆææ¡ˆè©³ç´°: `@Flow/202601/2026-01-02/late_api_integration_proposals.md`
