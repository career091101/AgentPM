---
name: orchestrate-trading-strategy
description: |
  日経平均先物の1週間スイングトレード戦略を自動生成するオーケストレータースキル。データ収集→並列分析→統合→バックテスト→戦略提示の全自動実行（90-120分）。ステージゲート管理（データ完全性95%以上/分析成功率66%以上/シャープレシオ1.0以上）で品質保証。未達成時は改善アクション提示。最終的に具体的なエントリー/エグジット/ストップロス価格を含む実行可能な戦略を提案します。

  使用タイミング：
  - 日経平均先物のトレード戦略が必要な時
  - 1週間スイングトレードの判断材料が欲しい時
  - データ駆動の客観的な戦略立案をしたい時

  所要時間：90-120分（自動実行、ステージゲートで停止）
  出力：トレード戦略提案（final_trading_strategy.md）
trigger_keywords:
  - "トレード戦略"
  - "日経平均先物"
  - "スイング戦略立案"
  - "日経225戦略"
  - "先物トレード"
  - "トレード分析"
  - "戦略生成"
stage: Trading Strategy Generation
dependencies:
  - agent-data-collector
  - agent-technical-analyst
  - agent-elliott-wave-analyst
  - agent-sentiment-analyst
  - agent-strategy-synthesizer
  - agent-backtest-validator
output_file: Stock/programs/資産運用/projects/TradingAgents/data/results/{YYYY-MM-DD}/final_trading_strategy.md
execution_time: 90-120分
framework_reference: Stock/programs/資産運用/projects/TradingAgents/knowledge/
priority: P0
framework_compliance: 100%
---

# Orchestrate Trading Strategy Skill

日経平均先物の1週間スイングトレード戦略を自律実行するオーケストレーターSkill。

---

## このSkillでできること

1. **完全自動実行**: 7ステップを順次実行（データ収集→並列分析→統合→バックテスト→戦略提示）
2. **ステージゲート管理**: データ完全性/分析成功率/バックテスト合格で品質保証
3. **並列分析実行**: テクニカル/エリオット波動/センチメントの3エージェントを並列実行
4. **エラーハンドリング**: 各Skillの失敗時に代替手段を提案
5. **具体的戦略提示**: エントリー/エグジット/ストップロス価格を明示した実行可能な戦略

---

## 入力・出力

| 項目 | 内容 |
|------|------|
| **入力** | なし（自動で最新データを収集） |
| **出力** | final_trading_strategy.md（エントリー/エグジット/ストップロス価格、リスク・リワード比率、エントリー根拠、期待値、実現可能性評価） |
| **次のアクション** | 戦略に基づくトレード実行 or 戦略の精査 |

---

## Instructions

**実行モード**: 自律実行（ステージゲートで停止）
**推定所要時間**: 90-120分

### 戦略生成ステップ（全7ステップ）

#### Phase 1: データ収集（15分）

**STEP 1**: `/agent-data-collector` - データ収集
- IG証券から日経平均先物の現在価格取得（Claude in Chrome MCP使用）
- Yahoo Finance/Investing.comから5年分ヒストリカルデータ取得（WebFetch使用）
- データ完全性チェック

**[ステージゲート1: データ完全性]**
- 判定基準: データ完全性 ≥ 95%
- 通過 → STEP 2へ進む
- 未達成 → **停止**、代替データソース提案、ユーザー承認後に再開

#### Phase 2: 並列分析（30分、3エージェント同時実行）

**STEP 2**: `/agent-technical-analyst` - テクニカル分析（並列1）
- 移動平均線、MACD、RSI、ボリンジャーバンド、ATR、出来高分析
- エントリー/エグジット/ストップロス価格の提案
- 信頼度スコア算出

**STEP 3**: `/agent-elliott-wave-analyst` - エリオット波動分析（並列2）
- 波動カウント（Primary/Intermediate/Minor）
- フィボナッチ目標価格算出
- メイン/サブシナリオの提示

**STEP 4**: `/agent-sentiment-analyst` - センチメント分析（並列3）
- Fear & Greed Index取得
- 市場心理の評価
- リスク警戒度の判定

**[ステージゲート2: 分析成功率]**
- 判定基準: 3エージェント中 ≥ 2成功
- 通過 → STEP 5へ進む
- 未達成 → **停止**、失敗エージェントのリトライ提案、ユーザー承認後に再開

#### Phase 3: 統合・検証（85分）

**STEP 5**: `/agent-strategy-synthesizer` - 戦略統合（20分）
- 3エージェントの分析結果を重み付け投票で統合
- エントリー価格: 加重平均で算出
- 目標価格: 最も保守的な値を採用
- ストップロス: 最も近い値を採用（リスク最小化）
- リスク・リワード比率、期待値、実現可能性評価の算出

**STEP 6**: `/agent-backtest-validator` - バックテスト検証（60分）
- 3-5年分データでバックテスト実行
- バイアス防止（ルックアヘッド、サバイバーシップ、オーバーフィッティング）
- ウォークフォワード分析（WF効率 ≥ 50%）
- マーケットレジーム別評価（全レジームでシャープレシオ > 0.3）

**[ステージゲート3: バックテスト合格]**
- 判定基準: シャープレシオ ≥ 1.0 AND WF効率 ≥ 50%
- 通過 → STEP 7へ進む
- 未達成 → **停止**、戦略パラメータ調整提案、ユーザー承認後に再実行 or 戦略不採用判定

#### Phase 4: 最終出力（5分）

**STEP 7**: 最終レポート生成
- final_trading_strategy.md の生成
- 必須9項目の完備確認（対象商品、取引方向、エントリー価格、エグジット価格、ストップロス価格、リスク・リワード比率、エントリー根拠、期待値比率、実現可能性評価）
- 参照レポートへのリンク設定

---

## ステージゲート判定基準

| ゲート | 判定基準 | 通過条件 | 未達成時の対応 |
|-------|---------|---------|--------------|
| Gate 1: データ完全性 | データ完全性 ≥ 95% | 欠損データ < 5% | 代替データソース使用 |
| Gate 2: 分析成功率 | 3エージェント中 ≥ 2成功 | テクニカル+エリオット成功必須 | 失敗エージェントのリトライ |
| Gate 3: バックテスト | シャープレシオ ≥ 1.0 AND WF効率 ≥ 50% | Test期間でも性能維持 | パラメータ調整 or 戦略不採用 |

---

## 成果物フォーマット

最終出力ファイル: `Stock/programs/資産運用/projects/TradingAgents/data/results/{YYYY-MM-DD}/final_trading_strategy.md`

```markdown
# 日経平均先物 トレード戦略提案

生成日時: {YYYY-MM-DD HH:MM:SS}

---

## 推奨戦略（1週間スイング）

- **対象商品**: 日経平均先物（日本225株価指数）
- **取引方向**: [買い/売り]
- **エントリー価格**: [具体的な数値]円
- **エグジット価格（利益確定）**: [具体的な数値]円
- **ストップロス価格（損切り）**: [具体的な数値]円
- **リスク・リワード比率**: 1対[数値]
- **エントリー根拠**:
  1. テクニカル: [詳細]
  2. エリオット波動: [詳細]
  3. センチメント: [詳細]
- **期待値比率**: [+/-]X.XX%
- **実現可能性評価**: [高/中/低]（理由）

---

## 詳細分析サマリー

### データ品質
- データ完全性: XX.X%
- 分析期間: YYYY-MM-DD ~ YYYY-MM-DD（X年間、X,XXX営業日）

### エージェント判定結果
| エージェント | シグナル | 信頼度 | 重み |
|-------------|---------|-------|------|
| テクニカル分析 | [買い/売り/中立] | XX% | X.X |
| エリオット波動 | [買い/売り/中立] | XX% | X.X |
| センチメント分析 | [買い/売り/中立] | XX% | X.X |
| **統合判定** | **[買い/売り]** | **XX%** | - |

### バックテスト結果
- 総合評価: [合格 ✅ / 不合格 ❌]
- シャープレシオ: X.XX（Test期間: X.XX）
- WF効率: XX%（基準50%以上）
- 全レジームでシャープレシオ > 0.3 [達成 ✅ / 未達成 ❌]

---

## リスク管理ガイドライン

1. **ポジションサイズ**: 資金の2%以内を推奨
2. **執行タイミング**: [具体的な価格レンジ]
3. **利益確定**: [具体的な価格]到達で全量決済
4. **損切り**: [具体的な価格]を明確に割れた場合、即座に損切り
5. **保有期間**: 最大1週間（5営業日）

---

## 参照レポート

- テクニカル分析: `technical_analysis.md`
- エリオット波動分析: `elliott_wave_analysis.md`
- センチメント分析: `sentiment_analysis.md`
- 統合戦略: `synthesized_strategy.md`
- バックテスト検証: `backtest_validation_report.md`

---

**免責事項**: 本戦略は過去データに基づく統計的分析結果であり、将来の投資成果を保証するものではありません。投資判断は自己責任で行ってください。
```

---

## Knowledge Base参照

- テクニカル指標: `Stock/programs/資産運用/projects/TradingAgents/knowledge/technical_indicators.md`
- エリオット波動ルール: `Stock/programs/資産運用/projects/エリオット波動分析/knowledge/`
- バックテスト方法論: `Stock/programs/資産運用/projects/TradingAgents/knowledge/backtest_methodology.md`
- リスク管理: `Stock/programs/資産運用/projects/TradingAgents/knowledge/risk_management.md`

---

## 使用例

### 基本的な使用

```
User: 日経平均先物のトレード戦略を立案して
```

システムが自動的に：
1. IG証券から最新データ取得
2. 5年分のヒストリカルデータ取得
3. テクニカル/エリオット/センチメント分析を並列実行
4. 3エージェントの結果を統合
5. バックテストで検証
6. final_trading_strategy.md を生成

---

## エラーハンドリング

### データ収集失敗時
- IG証券アクセス失敗 → WebFetchで代替ソース（Yahoo Finance、Investing.com）使用
- ヒストリカルデータ欠損 → 利用可能な期間で分析継続（最低3年必要）

### 分析失敗時
- テクニカル分析失敗 → 基本指標（MA, RSI）のみで再実行
- エリオット波動分析失敗 → テクニカル+センチメントのみで統合
- センチメント分析失敗 → テクニカル+エリオットのみで統合（2/3成功で通過）

### バックテスト不合格時
- シャープレシオ < 1.0 → パラメータ調整提案 or 「現時点では明確な戦略なし」判定
- WF効率 < 50% → オーバーフィッティング警告、戦略不採用

---

## 実行時の注意事項

1. **実行時間**: 90-120分かかるため、時間に余裕があるときに実行
2. **データソース**: IG証券のWebサイト変更により取得失敗の可能性あり（代替ソース自動使用）
3. **市場休場日**: 土日祝日は最新データ取得不可、前営業日データで代用
4. **免責事項**: 生成された戦略は参考情報であり、投資判断は自己責任

---

## 更新履歴

- 2025-12-29: 初版作成（MVP Phase 1）
