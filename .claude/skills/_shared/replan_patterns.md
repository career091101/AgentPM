# Replan Patterns - リプラン判断パターン定義

レビューループにおけるリプラン判断の標準パターンと修正指示生成ロジック。

**最終更新**: 2026-01-02
**バージョン**: 1.0（Week 5）

---

## 概要

品質スコアが閾値未満の場合、Manager Skillは問題パターンを特定し、SubAgentへの修正指示を自動生成します。

**目的**:
- 問題の根本原因を特定
- 具体的かつ実行可能な修正指示を生成
- イテレーション間でのスコア改善を保証

---

## リプラン判断基準

| 総合スコア | 判定 | 対応 |
|-----------|------|------|
| 70点以上 | ✅ 合格 | 統合完了 |
| 60-69点 | ⚠️ 条件付き合格 | 警告ログ記録 + 統合 |
| 60点未満 | ❌ 不合格 | リプラン必須 |

**リプラン必須時の処理**:
1. 各観点のスコアを分析
2. 該当する問題パターンを特定（複数可）
3. パターン別の修正指示を生成
4. SubAgentへの追加指示を更新
5. Iteration N+1を開始

---

## Pattern 1: セクション不足

### 検出条件

```
completeness_score < 15
```

**該当例**:
- 必須セクション10件中6件しか実装されていない（60%）→ completeness_score = 15点
- 必須セクション10件中5件しか実装されていない（50%）→ completeness_score = 12.5点

### 問題の原因

1. **必須セクションの理解不足**: SubAgentがドキュメントタイプの必須セクションを正確に把握していない
2. **指示の曖昧性**: Manager Skillからの指示が不明確
3. **テンプレート未参照**: 既存のテンプレートやサンプルを参照していない

### 修正指示テンプレート

```markdown
## 修正指示（Pattern 1: セクション不足）

**問題**: 必須セクション{required_count}件中{found_count}件のみ実装（{percentage}%）

**未実装セクション**:
{missing_sections_list}

**修正方針**:
1. 以下のセクションを必ず追加してください:
   - **{セクション名1}**: {具体例・期待内容}
   - **{セクション名2}**: {具体例・期待内容}
   - **{セクション名3}**: {具体例・期待内容}

2. 各セクションには以下を含めてください:
   - 具体的なデータ・数値
   - 固有名詞（企業名、製品名、技術名）
   - 論理的な説明

3. 参照テンプレート: @.claude/skills/_shared/templates/{doc_type}_template.md

**期待される改善**:
- completeness_score: {current_score}点 → **20点以上**（80%以上）
```

### SubAgentへの追加指示例

```markdown
## 追加指示（Iteration 2）

**前回の問題**: 必須セクション10件中6件のみ実装（60%）

**今回必須のセクション**:
1. **不公正な優位性**:
   - 模倣困難な要素を3つ以上挙げる
   - 例: 独自データベース、特許技術、ネットワーク効果
2. **主要指標**:
   - CPF検証で追跡すべきKPIを5つ以上定義
   - 例: NPS、顧客インタビュー実施数、アンケート回収率
3. **チャネル**:
   - 顧客獲得経路を3つ以上具体化
   - 例: SNS広告、オーガニック検索、紹介プログラム
4. **コスト構造**:
   - 主要なコスト項目を5つ以上列挙
   - 例: 人件費、インフラ費、マーケティング費

**参照**: @startup_science/01_frameworks/cpf_validation.md
```

---

## Pattern 2: 論理的矛盾

### 検出条件

```
logic_score < 15
```

**該当例**:
- 「市場規模が小さい」と言いながら「急成長市場」と主張
- 「競合が少ない」と言いながら「競争激化」と矛盾
- CPFスコア算出根拠が不明確

### 問題の原因

1. **論理の飛躍**: 前提と結論の間に論理的な接続がない
2. **矛盾する主張**: 文書内で異なる主張が混在
3. **根拠の欠如**: 主張に対する裏付けが不明確

### 修正指示テンプレート

```markdown
## 修正指示（Pattern 2: 論理的矛盾）

**問題**: 論理的矛盾が検出されました

**矛盾箇所**:
{contradiction_details}

**修正方針**:
1. 矛盾する主張を特定し、一貫性のある記述に修正
2. 前提と結論の論理的接続を明示
3. 主張に対する根拠を明記

**具体例**:
- ❌ 「市場規模が小さい（TAM 100億円）が急成長市場」
- ✅ 「市場規模はTAM 100億円と限定的だが、CAGR 30%の急成長市場」

**期待される改善**:
- logic_score: {current_score}点 → **20点以上**
```

### SubAgentへの追加指示例

```markdown
## 追加指示（Iteration 2）

**前回の問題**: 論理的矛盾が検出されました

**修正箇所**:
1. **市場規模セクション**:
   - TAM/SAM/SOMの区別を明確化
   - 「市場規模が小さい」という表現を削除
   - 「ニッチ市場だが高成長」と修正
   - CAGR（年平均成長率）を明記

2. **CPFスコア算出ロジック**:
   - 6項目の評価基準を具体化
   - 各項目の配点（例: 顧客セグメント15点、課題20点...）を明示
   - 合計点の算出方法を記述

3. **競合分析セクション**:
   - 「競合が少ない」という主張を削除
   - 「直接競合3社、間接競合5社」と具体化
   - 差別化ポイントを明確に記述
```

---

## Pattern 3: 抽象的表現

### 検出条件

```
specificity_score < 12
```

**該当例**:
- 「多くのユーザー」→ 具体的な数値なし
- 「優れたUX」→ 具体的な説明なし
- 「高い成長率」→ 数値の裏付けなし

### 問題の原因

1. **定量データ不足**: 具体的な数値が含まれていない
2. **固有名詞の欠如**: 企業名、製品名、技術名が不明確
3. **事例の不足**: 具体的な事例や実例がない

### 修正指示テンプレート

```markdown
## 修正指示（Pattern 3: 抽象的表現）

**問題**: 抽象的な表現が多く、具体性が不足しています

**抽象的な表現**:
{abstract_phrases_list}

**修正方針**:
1. すべての主張に具体的な数値を追加
2. 固有名詞（企業名、製品名、技術名）を明記
3. 具体的な事例を1つ以上含める

**具体例**:
- ❌ 「多くのユーザーが課題を実感」
- ✅ 「アンケート回答者500名中425名（85%）が課題を実感」

- ❌ 「優れたUX」
- ✅ 「タスク完了時間を従来比30%短縮、NPS 72点を達成するUX設計」

**期待される改善**:
- specificity_score: {current_score}点 → **16点以上**（80%以上）
```

### SubAgentへの追加指示例

```markdown
## 追加指示（Iteration 2）

**前回の問題**: 抽象的な表現が多く、具体性が不足

**今回必須の具体化**:
1. **顧客セグメントセクション**:
   - 「多くのユーザー」→ 「月間アクティブユーザー5万人」
   - 「企業の担当者」→ 「従業員50-500名規模のSaaS企業のプロダクトマネージャー」
   - 年齢層、職種、企業規模を数値で明記

2. **課題セクション**:
   - 「困っている」→ 「週に10時間以上を手作業に費やしている」
   - 「非効率」→ 「タスク完了に平均3.5時間かかる（目標1.5時間）」

3. **解決策セクション**:
   - 「優れたUX」→ 「3クリック以内でタスク完了、操作時間50%削減」
   - 「最新技術」→ 「React 18 + TypeScript + Supabase構成」
   - 技術スタックの固有名詞を明記

4. **事例の追加**:
   - 「多くの企業で成功」→ 「A社では導入後3ヶ月で業務時間20%削減、B社では顧客満足度NPS 65→82に向上」
```

---

## Pattern 4: エビデンス不足

### 検出条件

```
evidence_score < 9
```

**該当例**:
- 市場規模の出典が不明
- 競合分析のデータソースがない
- 主張を裏付けるデータがない

### 問題の原因

1. **データ裏付けの欠如**: 主張がデータに基づいていない
2. **出典の未明記**: 引用元や参照が不明確
3. **定量データの不足**: 定性的な記述のみで定量的データがない

### 修正指示テンプレート

```markdown
## 修正指示（Pattern 4: エビデンス不足）

**問題**: 主張を裏付けるエビデンスが不足しています

**エビデンス不足箇所**:
{missing_evidence_list}

**修正方針**:
1. すべての市場規模推定に出典を明記
   - 推奨ソース: 総務省、経済産業省、McKinsey、Gartner、Forrester
2. 競合分析にデータソースを追加
   - 推奨ソース: Crunchbase、SimilarWeb、公式プレスリリース
3. 定量的なデータを含める
   - アンケート結果、インタビュー実施数、統計データ

**具体例**:
- ❌ 「市場は拡大している」
- ✅ 「市場規模は2024年で10兆円、CAGR 15%で成長中（出典: 総務省情報通信白書2024）」

**期待される改善**:
- evidence_score: {current_score}点 → **12点以上**（80%以上）
```

### SubAgentへの追加指示例

```markdown
## 追加指示（Iteration 2）

**前回の問題**: エビデンスが不足しています

**今回必須のエビデンス追加**:
1. **市場規模セクション**:
   - TAM: 10兆円（出典: 総務省「情報通信白書2024」p.123）
   - SAM: 1,000億円（出典: Gartner "SaaS Market Forecast 2024"）
   - SOM: 50億円（自社推定、獲得可能市場シェア5%）

2. **競合分析セクション**:
   - A社: 月間アクティブユーザー10万人（出典: Crunchbase）
   - B社: 年間売上50億円（出典: 公式プレスリリース2024年3月）
   - C社: 導入企業500社（出典: 公式Webサイト）

3. **課題検証セクション**:
   - アンケート実施: 500名（2024年11月実施）
   - インタビュー実施: 10名（2024年12月実施）
   - 課題実感率: 85%（500名中425名）

4. **CPFスコア算出セクション**:
   - 顧客セグメント: 15/20点（インタビュー10名中9名が明確に定義可能）
   - 課題: 18/20点（アンケート85%が実感）
   - 解決策: 12/20点（プロトタイプ評価NPS 60）
   - 合計: 60/100点
```

---

## Pattern 5: フレームワーク逸脱

### 検出条件

```
framework_compliance_score < 9
```

**該当例**:
- CPF/PSF/PMFの検証軸が不適切
- Lean Startupの原則に反している
- スタートアップサイエンスのフレームワークを無視

### 問題の原因

1. **フレームワーク理解不足**: CPF/PSF/PMFの評価軸を理解していない
2. **検証方法の誤り**: 定性的な検証のみで定量的な検証がない
3. **段階の混同**: CPFフェーズでPMFの指標を使用している

### 修正指示テンプレート

```markdown
## 修正指示（Pattern 5: フレームワーク逸脱）

**問題**: スタートアップサイエンスのフレームワークに準拠していません

**逸脱箇所**:
{framework_violations_list}

**修正方針**:
1. CPF/PSF/PMFの各フェーズに適した評価軸を使用
2. Lean Startupの「構築→計測→学習」サイクルを反映
3. 定性的検証と定量的検証の両方を含める

**CPFフェーズの評価軸**:
- **顧客セグメント**: ペルソナ定義、TAM/SAM/SOM
- **課題**: 課題インタビュー、課題実感率
- **解決策**: ソリューション仮説、代替手段との比較

**期待される改善**:
- framework_compliance_score: {current_score}点 → **12点以上**（80%以上）
```

### SubAgentへの追加指示例

```markdown
## 追加指示（Iteration 2）

**前回の問題**: スタートアップサイエンスのフレームワークに準拠していません

**今回必須のフレームワーク準拠**:
1. **CPF検証の評価軸**:
   - ❌ 「ユニットエコノミクス」（PMF指標）を削除
   - ✅ 「課題インタビュー10件実施、85%が課題を実感」を追加

2. **PSF検証の評価軸**:
   - ❌ 「月次成長率20%」（PMF指標）を削除
   - ✅ 「プロトタイプ評価NPS 60、タスク完了時間30%短縮」を追加

3. **Lean Startupサイクル**:
   - **構築**: プロトタイプ作成（2週間）
   - **計測**: ユーザーテスト実施（NPS、タスク完了時間）
   - **学習**: フィードバックを元にピボット判断

4. **参照フレームワーク**:
   - @startup_science/01_frameworks/cpf_validation.md
   - @startup_science/01_frameworks/psf_validation.md
   - The Lean Startup（Eric Ries）第3章
```

---

## 複数パターンの組み合わせ

複数のパターンが同時に検出された場合、優先順位順に修正指示を生成します。

### 優先順位

1. **Pattern 1（セクション不足）**: 完全性が最優先
2. **Pattern 2（論理的矛盾）**: 論理的整合性を確保
3. **Pattern 4（エビデンス不足）**: データ裏付けを追加
4. **Pattern 3（抽象的表現）**: 具体性を向上
5. **Pattern 5（フレームワーク逸脱）**: フレームワーク準拠を確認

### 組み合わせ例

**ケース1: Pattern 1 + Pattern 4**
```markdown
## 修正指示（Iteration 2）

### 優先度1: Pattern 1（セクション不足）
- 未実装セクション: 不公正な優位性、主要指標、チャネル
- 修正指示: 上記3セクションを追加

### 優先度2: Pattern 4（エビデンス不足）
- 市場規模の出典を追加（総務省、McKinsey等）
- アンケート結果、インタビュー実施数を明記
```

**ケース2: Pattern 2 + Pattern 3**
```markdown
## 修正指示（Iteration 2）

### 優先度1: Pattern 2（論理的矛盾）
- 矛盾箇所: 「市場規模が小さい」vs「急成長市場」
- 修正指示: TAM/SAM/SOMを明確化し、成長率との関係を整理

### 優先度2: Pattern 3（抽象的表現）
- 「多くのユーザー」→ 具体的な数値に置き換え
- 「優れたUX」→ NPS、タスク完了時間等の定量指標を追加
```

---

## リプラン効果の測定

各パターンに対する期待改善スコアを設定し、実際の改善を測定します。

| パターン | 観点 | 期待改善 |
|---------|------|----------|
| Pattern 1 | completeness | +5点以上 |
| Pattern 2 | logic | +5点以上 |
| Pattern 3 | specificity | +4点以上 |
| Pattern 4 | evidence | +3点以上 |
| Pattern 5 | framework_compliance | +3点以上 |

**改善不十分の場合**:
- Iteration 2でスコアが期待値以下 → Iteration 3で指示をさらに具体化
- Iteration 3でも改善不十分 → Human-in-the-Loop

---

## Human-in-the-Loop トリガー

以下の条件でHuman-in-the-Loopを発動します:

1. **3回連続不合格**: Iteration 3でも品質スコア < 70点
2. **スコア改善なし**: Iteration N+1でスコアが改善しない（±2点以内）
3. **致命的エラー**: Review Agentがエラーで停止

**Human-in-the-Loop時の提示情報**:
- すべてのイテレーションの証拠記録（task_breakdown, review_report, quality_score）
- 問題パターンの詳細分析
- 推奨される手動修正箇所

---

## 関連ドキュメント

- **品質基準**: `.claude/skills/_shared/review_criteria.md`
- **証拠記録システム**: `.claude/skills/_shared/evidence_system.md`
- **Manager Skill**: `.claude/skills/orchestrate-review-loop/SKILL.md`
- **Review Agent**: `.claude/agents/review-agent.md`
- **エラーハンドリング**: `.claude/skills/_shared/error_handling_patterns.md`
