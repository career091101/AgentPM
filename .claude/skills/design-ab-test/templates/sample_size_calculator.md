# サンプルサイズ計算シート

**テスト名**: ________________
**テスト対象**: ________________
**計算日**: __________

---

## 1. 計算パラメータの入力

### 基本情報

**コントロールのCVR（p1）**: ______% （現在の実績値）
**期待されるCVR（p2）**: ______% （目標値）

**例**:
- 現在CVR 3% → 目標CVR 5% の場合、p1 = 0.03, p2 = 0.05

### 統計的パラメータ

| パラメータ | 値 | 説明 |
|-----------|-----|------|
| **有意水準（α）** | 0.05 | 95%信頼区間（固定値） |
| **検出力（1-β）** | 0.80 | 80%の確率でバリアント効果を検出（固定値） |
| **バリアント数** | _____ | 2バリアント（推奨）または3バリアント |

---

## 2. サンプルサイズ計算公式

### Two-Proportion Z-Test 公式

```
n = [(z_α * √(2*p_pooled*(1-p_pooled)) + z_β * √(p1*(1-p1) + p2*(1-p2))) / (p1 - p2)]²

ここで：
- z_α = 1.96（有意水準α=0.05の両側検定）
- z_β = 0.84（検出力80%の場合）
- p_pooled = (p1 + p2) / 2（プール推定量）
```

### 簡易計算表

p1 = ___%, p2 = __% の場合、以下の表から該当セルを参照：

| p1（現在） | p2（期待） | 各バリアント必要数 | 合計（2バリ） | 合計（3バリ） |
|-----------|----------|------------------|------------|------------|
| 2% | 2.5% | 16,800 | 33,600 | 50,400 |
| 2% | 3% | 5,250 | 10,500 | 15,750 |
| 3% | 4% | 5,300 | 10,600 | 15,900 |
| 3% | 5% | 1,571 | 3,142 | 4,713 |
| 5% | 7% | 2,000 | 4,000 | 6,000 |

**該当するセルをチェック** ✓

**または詳細計算**を以下で実施してください：

---

## 3. 詳細計算ステップ

### ステップ1：プール推定量を計算

```
p_pooled = (p1 + p2) / 2
        = (0.03 + 0.05) / 2
        = 0.04
```

**入力値**:
```
p1 = ______ , p2 = ______
p_pooled = (______ + ______) / 2 = ______
```

### ステップ2：標準正規分布の値を設定

```
z_α（両側検定、α=0.05） = 1.96
z_β（検出力80%） = 0.84
```

### ステップ3：平方根内の計算

```
√(2*p_pooled*(1-p_pooled)) = √(2 * 0.04 * 0.96)
                             = √0.0768
                             = 0.277

√(p1*(1-p1) + p2*(1-p2)) = √(0.03*0.97 + 0.05*0.95)
                          = √(0.0291 + 0.0475)
                          = √0.0766
                          = 0.277
```

**計算結果**:
```
√(2*p_pooled*(1-p_pooled)) = ______
√(p1*(1-p1) + p2*(1-p2)) = ______
```

### ステップ4：分子を計算

```
分子 = z_α * √(...) + z_β * √(...)
     = 1.96 * 0.277 + 0.84 * 0.277
     = 0.542 + 0.233
     = 0.775
```

**計算結果**: ______

### ステップ5：差分を計算

```
差分 = p2 - p1 = 0.05 - 0.03 = 0.02
```

**計算結果**: ______

### ステップ6：最終計算

```
n = (分子 / 差分)²
  = (0.775 / 0.02)²
  = (38.75)²
  = 1,501.6
  → 1,502（切り上げ）
```

**各バリアント必要サンプル数**: **______**

---

## 4. テスト規模の決定

### 2バリアント（A/B）の場合

```
合計必要サンプル数 = n × 2
                = ______ × 2
                = ______
```

**合計**: ______ 訪問者

### 3バリアント（A/B/C）の場合

```
合計必要サンプル数 = n × 3
                = ______ × 3
                = ______
```

**合計**: ______ 訪問者

---

## 5. テスト期間の推定

### 週間トラフィックの入力

**現在の週間訪問者数（UV）**: ______ 訪問者/週

測定期間：____年____月 ～ ____年____月（過去4週間の平均）

### テスト期間計算

#### 2バリアント実施時

```
テスト期間（週） = 合計必要サンプル数 ÷ 週間トラフィック
               = ______ ÷ ______
               = ______ 週
               → ______ 週（切り上げ）
```

**推定期間**: **____週間** （約____日）

#### 3バリアント実施時

```
テスト期間（週） = ______ ÷ ______
               = ______ 週
               → ______ 週（切り上げ）
```

**推定期間**: **____週間** （約____日）

---

## 6. リスク評価

### テスト期間チェック

- [ ] **< 4週間**：短すぎ。データ不足、シーズン変動の影響不明確
- [ ] **4-8週間**：✅ **推奨範囲**
- [ ] **8-12週間**：⚠️ シーズン変動の影響あり。期待効果再検討推奨
- [ ] **12週間超**：❌ 長すぎ。期待効果を大きくする、トラフィック増加を検討

### リスク対策

**8週間を超える場合**、以下を実施してください：

| 対策 | 削減効果 | 実現性 |
|-----|---------|--------|
| 期待効果を大きくする（3% → 6%） | サンプルサイズ50%削減 | ★★☆ |
| 広告配信でトラフィック2倍化 | テスト期間50%削減 | ★★★ |
| 有関心層のみを対象化 | CVR向上により加速 | ★★☆ |

**選択した対策**: ________________________________________________________________________________

---

## 7. トラフィック分配計画

### 均等分配（推奨）

#### 2バリアント（A/B）
```
コントロール（A）: 50%
バリアント（B）: 50%
```

#### 3バリアント（A/B/C）
```
コントロール（A）: 33-34%
バリアント（B）: 33%
バリアント（C）: 33%
```

**選択**: ____ バリアント（A/__/__）

### トラフィック配分チェックリスト

- [ ] A/Bテスト機能がランダム配分に対応（>95%ランダム性）
- [ ] 配分比が実装されている
- [ ] QA環境で動作確認完了

---

## 8. 最終チェックリスト

計算完了後、以下を確認してください：

- [ ] 各バリアント必要サンプル数が算出されている
- [ ] 合計サンプル数が決定されている
- [ ] 週間トラフィックが正確に入力されている
- [ ] 推定テスト期間が4-8週間の範囲内（8週間超の場合は対策済み）
- [ ] リスク評価が完了している
- [ ] トラフィック分配計画が立案されている
- [ ] 関係者（PM、マーケティング）の承認が取得されている

**承認者**: ________________ （署名 / チェック）

---

## 9. 参考資料

### 標準値参照表（パターン別）

| パターン | p1 | p2 | n/variant | 期間（週間500UV） |
|---------|-----|-----|-----------|-----------------|
| **小規模改善** | 2% | 2.5% | 16,800 | 67週 ❌ |
| **中規模改善** | 3% | 4% | 5,300 | 21週 ⚠️ |
| **大規模改善** | 3% | 5% | 1,571 | 6週 ✅ |
| **強気改善** | 5% | 7% | 2,000 | 8週 ✅ |

---

## 次のステップ

このシート完成後：

1. **仮説設定テンプレート確認** → `ab_test_hypothesis.md` の全項目が埋まっているか確認
2. **バリエーション詳細設計** → Figma で各バリアントの詳細デザインを作成
3. **実装・QA** → A/Bテスト機能に配置、動作確認
4. **テスト実施** → 推定期間 × 週間トラフィックでデータ蓄積開始

---

**計算実施者**: ________________
**承認日**: __________
**バージョン**: v1.0

**注**: このシートは Google Sheets でも Excel でも利用可能です。計算が自動化される場合は、公式に準拠した関数を使用してください。
