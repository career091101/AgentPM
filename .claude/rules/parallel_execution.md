# Parallel Agent Execution Rules

並列エージェント実行の標準ルール。

## 基本原則

### 🚨 必須ルール（最優先）

1. **最大5エージェント並列実行**: 複数タスクがある場合、最大5つのエージェントを単一メッセージで同時起動すること
2. **最適モデル選択必須**: 各エージェントは必ず `model` パラメータでタスクに最適なモデルを指定すること
   - データ収集・単純変換 → `haiku`（コスト効率重視）
   - 分析・レポート作成 → `sonnet`（バランス重視）
   - 戦略立案・複雑分析 → `opus`（品質重視）

### 実行方針
- **Task tool で複数エージェントを同時起動**（単一メッセージ内で複数 `Task` 呼び出し）
- **常に5並列を目指す**：タスクが5つ以上ある場合は5エージェントずつバッチ実行
- 各エージェントは完全自動実行（人の介入不要）
- スクリプト作成は最小限に、LLM 実行で完結
- 各エージェントは独立動作、共有データはファイル経由で連携

### 並列起動時の記述例
```markdown
エージェント1（Instagram収集）、エージェント2（Threads収集）、エージェント3（X収集）を並列起動します。

[単一メッセージ内で3つの Task tool を同時呼び出し]
```

## 並列エージェント数の推奨

### 標準ルール: 最大5並列

**デフォルトは5並列**。以下の表は例外ケースの参考値：

| タスクタイプ | 推奨並列数 | 理由 |
|------------|-----------|------|
| **標準タスク（デフォルト）** | **5** | 最大効率と安定性のバランス |
| **SNSデータ収集** | 5 | I/O待機が多く、並列効率が高い |
| **コンテンツ分析** | 5 | haiku使用で5並列可能 |
| **APIヘビー処理** | 3-5 | レート制限を考慮しつつ最大化 |
| **戦略立案・深い分析** | 1-2 | 複雑な思考が必要、逐次処理推奨 |


## モデル選択ガイドライン（必須）

### 🚨 modelパラメータは必須指定

Task tool 実行時、`model` パラメータを**必ず指定**すること。省略禁止。

| モデル | 用途 | コスト | 速度 | 使用条件 |
|--------|------|--------|------|----------|
| `haiku` | データ収集、単純変換、軽量タスク | 低 | 最速 | I/O待機が多い、単純処理 |
| `sonnet` | 標準分析、レポート作成、バランス型 | 中 | 中速 | 一般的なタスク（デフォルト推奨） |
| `opus` | 戦略立案、複雑な分析、最高品質 | 高 | 低速 | 重要な意思決定、複雑な推論 |

### タスク別モデル選択チートシート

```
📊 データ収集・変換系 → haiku
   例: SNS収集、CSV変換、ログ解析

🔍 コードベース探索 → haiku
   例: ファイル検索、パターンマッチング

📝 分析・レポート作成 → sonnet
   例: コンテンツ分析、ドキュメント生成

🌐 外部リサーチ → sonnet
   例: 競合調査、技術トレンド調査

🎯 戦略立案・設計 → opus
   例: アーキテクチャ設計、重要な計画策定
```


## 実行時間の目安

### 単一エージェント

| タスク複雑度 | 実行時間 | 例 |
|------------|---------|-----|
| **シンプル** | 5-15分 | データ収集、CSV変換 |
| **中程度** | 15-30分 | コンテンツ分析、レポート作成 |
| **複雑** | 30-60分 | 戦略立案、多段階分析 |
| **非常に複雑** | 60分以上 | 包括的リサーチ、大規模コード生成 |

### 並列実行（3-5エージェント）

- **総実行時間** = 最も遅いエージェントの時間
- **例**: 5エージェントで各20分 → 約20-25分で完了
- **シーケンシャル実行との比較**: 100分 → 25分（**4倍高速化**）

## 実践例

### 例1: SNS 5プラットフォーム同時分析（5並列）

```python
# 単一メッセージで5つのTask toolを同時起動
Task(subagent_type="general-purpose", model="haiku",
     description="Instagram収集", prompt="...")
Task(subagent_type="general-purpose", model="haiku",
     description="Threads収集", prompt="...")
Task(subagent_type="general-purpose", model="haiku",
     description="X収集", prompt="...")
Task(subagent_type="general-purpose", model="haiku",
     description="LinkedIn収集", prompt="...")
Task(subagent_type="general-purpose", model="haiku",
     description="TikTok収集", prompt="...")

# 総実行時間 = 最長エージェントの時間（約15-20分）
# シーケンシャル実行なら75-100分 → 5倍高速化
```

### 例2: コードベース調査 + 実装計画（5並列）

```python
Task(subagent_type="Explore", model="haiku",
     description="API実装調査", prompt="...")
Task(subagent_type="Explore", model="haiku",
     description="テスト構造調査", prompt="...")
Task(subagent_type="Explore", model="haiku",
     description="依存関係調査", prompt="...")
Task(subagent_type="general-purpose", model="sonnet",
     description="競合分析", prompt="...")
Task(subagent_type="Plan", model="sonnet",
     description="実装計画策定", prompt="...")
```


## エラーハンドリング

- 1つのエージェントが失敗しても、他のエージェントは継続実行
- 各エージェントは独立したファイル出力を行う
- 最終統合時に欠損データを検出し、必要に応じて再実行

## 運用時の注意

### 標準実行
1. **常に5エージェント並列を目指す**
2. タスクが5つ未満の場合は、タスクを分割して5並列に近づける
3. API制限がある場合のみ並列数を3-4に調整

### データ連携
- 共有データは CSV/JSON ファイルで受け渡し
- ファイル命名規則: `{platform}_{task}_{timestamp}.csv`
- 各エージェントは他エージェントのファイル完了を待たない（独立動作）

## 参照

- @docs/ai/overview.md
- @.claude/agents/ （各Subagent定義）
